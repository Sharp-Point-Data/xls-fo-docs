# Formatting Objects

## Overview

Formatting objects are the building blocks of XSL-FO document presentation. Chapter 6 of the W3C XSL-FO 2.0 specification defines the complete catalog of formatting objects, organized into categories: block-level, inline-level, table, list, bookmark, out-of-line, and other formatting objects. This guide covers the chapter introduction, definitions common to many formatting objects, formatting object content models, the formatting objects summary, and the introductory sections for each category. Individual formatting object definitions are documented in their own `fo-*.md` files.

Source: [W3C XSL-FO 2.0 -- Formatting Objects](https://www.w3.org/TR/xslfo20/#fo-section)

## Introduction to Formatting Objects

The refined formatting object tree describes one or more intended presentations of the information within this tree. Formatting is the process which converts the description into a presentation. The presentation is represented, abstractly, by an area tree, as defined in the area model. Each possible presentation is represented by one or more area trees in which the information in the refined formatting object tree is positioned on a two and one-half dimensional surface.

There are three kinds of formatting objects:

1. **Those that generate areas** -- formatting objects of this kind are said to "generate one or more areas". They may both generate and return areas.
2. **Those that return areas, but do not generate them** -- formatting objects of this kind are said to "return one or more areas".
3. **Those that are used in the generation of areas** -- these act like parameters to the generation process. They are either a **layout object** or an **auxiliary object**.

The first and second kinds are typically called **flow objects**. The third kind is either a layout object or an auxiliary object.

## Definitions Common to Many Formatting Objects

This categorization leads to defining two traits which characterize the relationship between an area and the formatting objects which generate and return that area: **generated-by** and **returned-by**.

### generated-by

The value of the `generated-by` trait is a single formatting object. A formatting object F is defined to **generate** an area A if the semantics of F specify the generation of one or more areas and A is one of the areas thus generated, or is a substituted form of one of the areas thus generated, as specified in the line-building section of the area model.

In the case of substituted glyph-areas, the generating formatting object is deemed to be the formatting object which generated the glyph-area which comes first in the sequence of substituted glyph-areas. In the case of an inserted glyph-area (e.g., an automatically-generated hyphen) the generating formatting object is deemed to be the generating formatting object of the last glyph-area preceding the inserted glyph-area in the pre-order traversal of the area tree.

### returned-by

The value of the `returned-by` trait is a set of pairs, where each pair consists of a formatting object and a positive integer. The integer represents the position of the area in the ordering of all areas returned by the formatting object.

A formatting object F is defined to **return the sequence of areas** A, B, C, ... if the pair (F,1) is a member of the `returned-by` trait of A, the pair (F,2) is a member of the `returned-by` trait of B, the pair (F,3) is a member of the `returned-by` trait of C, and so on.

If an area is a member of the sequence of areas returned by a formatting object, then either it was generated by the formatting object or it was a member of the sequence of areas returned by a child of that formatting object. Not all areas returned by a child of a formatting object need be returned by that formatting object. A formatting object may generate an area that has, as some of its children areas, areas returned by the children of that formatting object. These children (in the area tree) of the generated area are not returned by the formatting object to which they were returned.

### Lineage

A set of nodes in a tree is a **lineage** if:

- there is a node N in the set such that all the nodes in the set are ancestors of N, and
- for every node N in the set, if the set contains an ancestor of N, it also contains the parent of N.

The set of formatting objects that an area is returned by is a lineage.

### Normal and Out-of-Line Areas

Areas returned by a formatting object may be either **normal** or **out-of-line**. Normal areas represent areas in the "normal flow of text"; that is, they become area children of the areas generated by the formatting object to which they are returned. Normal areas have a `returned-by` lineage of size one. There is only one kind of normal area.

Out-of-line areas are areas used outside the normal flow of text either because they are absolutely positioned or they are part of a `float` or footnote. Out-of-line areas may have a `returned-by` lineage of size greater than one.

The `area-class` trait indicates which class, normal or out-of-line, an area belongs to. For out-of-line areas, it also indicates the subclass of out-of-line area. The values for this trait are: "xsl-normal", "xsl-absolute", "xsl-footnote", "xsl-side-float", or "xsl-before-float". An area is normal if and only if the value of the `area-class` trait is "xsl-normal"; otherwise, the area is an out-of-line area.

### Reference-Area Chain

A **reference-area chain** is defined as a sequence of reference-areas that is either generated by the same formatting object that is not a page-sequence formatting object, or that consists of the region reference-areas or normal-flow-reference-areas generated using region formatting objects assigned to the same flow. The reference-areas in the sequence are said to be "contained" by the reference-area chain, and they have the same ordering relative to each other in the sequence as they have in the area tree, using pre-order traversal order of the area tree.

## Formatting Object Content

The content of a formatting object is described using XML content-model syntax. In some cases additional constraints, not expressible in XML content models, are given in prose.

### Block-Level FOs (%block;)

The parameter entity `%block;` in the content models contains the following formatting objects:

<!-- Source: https://www.w3.org/TR/xslfo20/#define-returned-by -->
```xml
     block
     block-container
     table-and-caption
     table
     list-block
```

### Inline-Level FOs (%inline;)

The parameter entity `%inline;` in the content models contains the following formatting objects:

<!-- Source: https://www.w3.org/TR/xslfo20/#define-returned-by -->
```xml
     bidi-override
     character
     external-graphic
     instream-foreign-object
     inline
     inline-container
     leader
     page-number
     page-number-citation
     page-number-citation-last
     scaling-value-citation
     basic-link
     multi-toggle
     index-page-citation-list
```

### Neutral Containers

The following formatting objects are "neutral" containers and may be used, provided that the additional constraints listed under each formatting object are satisfied, anywhere where #PCDATA, %block;, or %inline; are allowed:

<!-- Source: https://www.w3.org/TR/xslfo20/#define-returned-by -->
```xml
     multi-switch
     multi-properties
     index-range-begin
     index-range-end
     wrapper
     retrieve-marker
```

The following formatting objects are "neutral" containers that may be used as described by the constraints listed under each formatting object:

<!-- Source: https://www.w3.org/TR/xslfo20/#define-returned-by -->
```xml
     retrieve-table-marker
```

### Point-Defining FOs

The following formatting objects define "points" and may be used anywhere as a descendant of `fo:flow` or `fo:static-content`:

<!-- Source: https://www.w3.org/TR/xslfo20/#define-returned-by -->
```xml
     change-bar-begin
     change-bar-end
```

### Out-of-Line FOs

The following "out-of-line" formatting objects may be used anywhere where #PCDATA, %block;, or %inline; are allowed (except as a descendant of any "out-of-line" formatting object):

<!-- Source: https://www.w3.org/TR/xslfo20/#define-returned-by -->
```xml
     float
```

The following "out-of-line" formatting objects may be used anywhere where #PCDATA or %inline; are allowed (except as a descendant of any "out-of-line" formatting object):

<!-- Source: https://www.w3.org/TR/xslfo20/#define-returned-by -->
```xml
     footnote
```

## Formatting Objects Summary

The following is a summary of all formatting objects defined in XSL-FO:

| Formatting Object | Description |
|---|---|
| `fo:basic-link` | Used for representing the start resource of a simple link. |
| `fo:bidi-override` | Used where it is necessary to override the default Unicode-bidirectional-algorithm direction for different (or nested) inline scripts in mixed-language documents. |
| `fo:block` | Commonly used for formatting paragraphs, titles, headlines, figure and table captions, etc. |
| `fo:block-container` | Used to generate a block-level reference-area. |
| `fo:bookmark` | Used to identify an access point, by name, and to specify where that access point is within the current document or another external document. A given bookmark may be further subdivided into a sequence of (sub-)bookmarks. |
| `fo:bookmark-title` | Used to identify, in human readable form, an access point. |
| `fo:bookmark-tree` | Used to hold a list of access points within the document such as a table of contents, a list of figures or tables, etc. |
| `fo:change-bar-begin` | Used to indicate the beginning of a "change region" ended by its matching `fo:change-bar-end`. The change region is decorated with a change bar. |
| `fo:change-bar-end` | Used to indicate the end of a "change region" started by its matching `fo:change-bar-begin`. |
| `fo:character` | Represents a character that is mapped to a glyph for presentation. |
| `fo:color-profile` | Used to declare a color profile for a stylesheet. |
| `fo:conditional-page-master-reference` | Used to identify a page-master that is to be used when the conditions on its use are satisfied. |
| `fo:declarations` | Used to group global declarations for a stylesheet. |
| `fo:external-graphic` | Used for a graphic where the graphics data resides outside of the XML result tree in the fo namespace. |
| `fo:float` | Serves two purposes: placing related content at the beginning of a page (before-float), or floating an area to one side with normal content flowing alongside (side-float). |
| `fo:flow` | Contains a sequence of flow objects that provides the flowing text content distributed into pages. |
| `fo:flow-assignment` | Used to specify the assignment of one sequence of flows to a sequence of regions. |
| `fo:flow-map` | Used to specify the assignment of flows to regions. |
| `fo:flow-name-specifier` | Used to specify one flow in a source-list. |
| `fo:flow-source-list` | Used to specify the sequence of flows to assign in a particular `fo:flow-assignment`. |
| `fo:flow-target-list` | Used to specify the sequence of regions to which flows are assigned in a particular `fo:flow-assignment`. |
| `fo:folio-prefix` | Specifies a static prefix for the folio numbers within a page-sequence. |
| `fo:folio-suffix` | Specifies a static suffix for the folio numbers within a page-sequence. |
| `fo:footnote` | Used to produce a footnote citation and the corresponding footnote. |
| `fo:footnote-body` | Used to generate the content of the footnote. |
| `fo:index-key-reference` | Used to generate a set of cited page items for all occurrences of the specified index-key. |
| `fo:index-page-citation-list` | Used to group together the sets of cited page items generated by its `fo:index-key-reference` children, generating a formatted list of page numbers and ranges. |
| `fo:index-page-citation-list-separator` | Specifies the formatting objects used to separate singleton page numbers or page number ranges in the generated list. |
| `fo:index-page-citation-range-separator` | Specifies the formatting objects used to separate two page numbers forming a range. |
| `fo:index-page-number-prefix` | Specifies a static prefix for the cited page items created by `fo:index-key-reference`. |
| `fo:index-page-number-suffix` | Specifies a static suffix for the cited page items created by `fo:index-key-reference`. |
| `fo:index-range-begin` | Used to indicate the beginning of an "indexed range" associated with an index key. |
| `fo:index-range-end` | Used to indicate the end of an "indexed range" started by its matching `fo:index-range-begin`. |
| `fo:initial-property-set` | Specifies formatting properties for the first line of an `fo:block`. |
| `fo:inline` | Commonly used for formatting a portion of text with a background or enclosing it in a border. |
| `fo:inline-container` | Used to generate an inline reference-area. |
| `fo:instream-foreign-object` | Used for an inline graphic or other "generic" object where the object data resides as descendants of the `fo:instream-foreign-object`. |
| `fo:layout-master-set` | A wrapper around masters used in the document. |
| `fo:leader` | Used to generate leaders consisting of a rule or a row of repeating characters, often used for connecting two text formatting objects. |
| `fo:list-block` | Used to format a list. |
| `fo:list-item` | Contains the label and the body of an item in a list. |
| `fo:list-item-body` | Contains the content of the body of a list-item. |
| `fo:list-item-label` | Contains the content of the label of a list-item; typically used to enumerate, identify, or adorn the list-item's body. |
| `fo:marker` | Used in conjunction with `fo:retrieve-marker` or `fo:retrieve-table-marker` to produce running headers or footers. |
| `fo:multi-case` | Used to contain (within an `fo:multi-switch`) each alternative sub-tree of formatting objects. |
| `fo:multi-properties` | Used to switch between two or more property sets associated with a given portion of content. |
| `fo:multi-property-set` | Used to specify an alternative set of formatting properties dependent on a User Agent state. |
| `fo:multi-switch` | Wraps the specification of alternative sub-trees of formatting objects and controls the switching from one alternative to another. |
| `fo:multi-toggle` | Used within an `fo:multi-case` to switch to another `fo:multi-case`. |
| `fo:page-number` | Used to represent the current page-number. |
| `fo:page-number-citation` | Used to reference the page-number for the page containing the first normal area returned by the cited formatting object. |
| `fo:page-number-citation-last` | Used to reference the page-number for the last page containing an area returned by the cited formatting object with a consistent area-class. |
| `fo:page-sequence` | Used to specify how to create a (sub-)sequence of pages within a document. Content comes from flow children. |
| `fo:page-sequence-master` | Specifies sequences of page-masters used when generating a sequence of pages. |
| `fo:page-sequence-wrapper` | Used to specify inherited properties for a group of `fo:page-sequence` formatting objects. No additional formatting semantics. |
| `fo:region-after` | Defines a viewport located on the "after" side of `fo:region-body`. |
| `fo:region-before` | Defines a viewport located on the "before" side of `fo:region-body`. |
| `fo:region-body` | Specifies a viewport/reference pair located in the "center" of the `fo:simple-page-master`. |
| `fo:region-end` | Defines a viewport located on the "end" side of `fo:region-body`. |
| `fo:region-name-specifier` | Used to specify one region in a target-list. |
| `fo:region-start` | Defines a viewport located on the "start" side of `fo:region-body`. |
| `fo:repeatable-page-master-alternatives` | Specifies a sub-sequence consisting of repeated instances of a set of alternative page-masters. |
| `fo:repeatable-page-master-reference` | Specifies a sub-sequence consisting of repeated instances of a single page-master. |
| `fo:retrieve-marker` | Used in conjunction with `fo:marker` to produce running headers or footers. |
| `fo:retrieve-table-marker` | Used in conjunction with `fo:marker` to produce table-headers and table-footers whose content can change over different pages, regions, or columns. |
| `fo:root` | The top node of an XSL result tree composed of formatting objects. |
| `fo:scaling-value-citation` | Used to obtain the scale-factor applied to the cited `fo:external-graphic`. |
| `fo:simple-page-master` | Used in the generation of pages and specifies the geometry of the page, subdivided into regions. |
| `fo:single-page-master-reference` | Specifies a sub-sequence consisting of a single instance of a single page-master. |
| `fo:static-content` | Holds a sequence or tree of formatting objects to be presented in a single region or repeated in like-named regions on one or more pages. Common use: repeating headers and footers. |
| `fo:table` | Used for formatting the tabular material of a table. |
| `fo:table-and-caption` | Used for formatting a table together with its caption. |
| `fo:table-body` | Used to contain the content of the table body. |
| `fo:table-caption` | Used to contain block-level formatting objects for the caption of the table (only when using `fo:table-and-caption`). |
| `fo:table-cell` | Used to group content to be placed in a table cell. |
| `fo:table-column` | Specifies characteristics applicable to table cells that have the same column and span. |
| `fo:table-footer` | Used to contain the content of the table footer. |
| `fo:table-header` | Used to contain the content of the table header. |
| `fo:table-row` | Used to group table-cells into rows. |
| `fo:title` | Used to associate a title with a given page-sequence. May be used by an interactive User Agent to identify the pages. |
| `fo:wrapper` | Used to specify inherited properties for a group of formatting objects. No additional formatting semantics. |

## Block-Level Formatting Objects

The `fo:block` formatting object is used for formatting paragraphs, titles, figure captions, table titles, etc. The following examples illustrate the usage of `fo:block` in a stylesheet.

### Example: Chapter and Section Formatting

The following example shows the use of `fo:block` for chapter and section titles, and paragraphs.

In this example the chapter title appears at the top of the page (its `space-before` is discarded). Space between chapter title and first section title is (8pt,8pt,8pt): the chapter title's `space-after` has a higher `precedence` than the section title's `space-before` (which takes on the initial value of zero), so the latter is discarded. Space between the first section title and section one's first paragraph is (6pt,6pt,6pt): the section title's `space-after` has higher `precedence` than the paragraph's `space-before`, so the latter is discarded. Space between the two paragraphs is (6pt,8pt,10pt): the `space-after` of the first paragraph is discarded because its `precedence` is equal to that of the `space-before` of the next paragraph, and the optimum of the `space-after` of the first paragraph is greater than the optimum of the `space-before` of the second paragraph. Space between the second paragraph of the first section and the title of the second section is (12pt,12pt,12pt): the `space-after` of the paragraph is discarded because its `precedence` is equal to that of the `space-before` of the section title, and the optimum of the `space-after` of the paragraph is less than the optimum of the `space-before` of the section title. The indent on the first line of the first paragraph in section one and the only paragraph in section two is zero; the indent on the first line of the second paragraph in section one is 2pc.

Input sample:

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_region-name-specifier -->
```xml
<doc>
  <chapter>
    <title>Chapter title</title>
    <section>
      <title>First section title</title>
      <paragraph>Section one's first paragraph.</paragraph>
      <paragraph>Section one's second paragraph.</paragraph>
    </section>
    <section>
      <title>Second section title</title>
      <paragraph>Section two's only paragraph.</paragraph>
    </section>
  </chapter>
</doc>
```

XSL Stylesheet:

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_region-name-specifier -->
```xml
<?xml version="1.0" encoding="utf-8"?>
<xsl:stylesheet
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:fo="http://www.w3.org/1999/XSL/Format">

<xsl:template match="chapter">
  <fo:block break-before="page">
    <xsl:apply-templates/>
  </fo:block>
</xsl:template>

<xsl:template match="chapter/title">
  <fo:block text-align="center" space-after="8pt"
            space-before="16pt" space-after.precedence="3">
    <xsl:apply-templates/>
  </fo:block>
</xsl:template>

<xsl:template match="section">
  <xsl:apply-templates/>
</xsl:template>

<xsl:template match="section/title">
  <fo:block text-align="center" space-after="6pt"
            space-before="12pt" space-before.precedence="0"
            space-after.precedence="3">
    <xsl:apply-templates/>
  </fo:block>
</xsl:template>

<xsl:template match="paragraph[1]" priority="1">
  <fo:block text-indent="0pc" space-after="7pt"
            space-before.minimum="6pt" space-before.optimum="8pt"
            space-before.maximum="10pt">
    <xsl:apply-templates/>
  </fo:block>
</xsl:template>

<xsl:template match="paragraph">
  <fo:block text-indent="2pc" space-after="7pt"
            space-before.minimum="6pt" space-before.optimum="8pt"
            space-before.maximum="10pt">
    <xsl:apply-templates/>
  </fo:block>
</xsl:template>

</xsl:stylesheet>
```

Result Instance: elements and attributes in the fo: namespace:

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_region-name-specifier -->
```xml
<fo:block break-before="page">

  <fo:block text-align="center" space-after="8pt"
    space-before="16pt"
    space-after.precedence="3">Chapter title
  </fo:block>

  <fo:block text-align="center" space-after="6pt"
    space-before="12pt" space-before.precedence="0"
    space-after.precedence="3">First section title
  </fo:block>

  <fo:block text-indent="0pc" space-after="7pt"
    space-before.minimum="6pt" space-before.optimum="8pt"
    space-before.maximum="10pt">Section one's first paragraph.
  </fo:block>

  <fo:block text-indent="2pc" space-after="7pt"
    space-before.minimum="6pt" space-before.optimum="8pt"
    space-before.maximum="10pt">Section one's second paragraph.
  </fo:block>

  <fo:block text-align="center" space-after="6pt"
    space-before="12pt" space-before.precedence="0"
    space-after.precedence="3">Second section title
  </fo:block>

  <fo:block text-indent="0pc" space-after="7pt"
    space-before.minimum="6pt" space-before.optimum="8pt"
    space-before.maximum="10pt">Section two's only paragraph.
  </fo:block>

</fo:block>
```

## Inline-Level Formatting Objects

Inline-level formatting objects are most commonly used to format a portion of text or for generating rules and leaders. There are many other uses. The following examples illustrate some of these uses of inline-level formatting objects:

- Putting the first line of a paragraph into small-caps
- Turning a normally inline formatting object, `fo:external-graphic`, into a block by "wrapping" with an `fo:block` formatting object
- Formatting a running footer containing the word "Page" followed by a page number

### Example: First Line of Paragraph in Small-caps

Input sample:

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_alternative-copyfit-content -->
```xml
<doc>
<p>This is the text of a paragraph that is going to be
presented with the first line in small-caps.</p>
</doc>
```

XSL Stylesheet:

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_alternative-copyfit-content -->
```xml
<?xml version='1.0'?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
                xmlns:fo="http://www.w3.org/1999/XSL/Format"
                version='1.0'>

<xsl:template match="p">
  <fo:block>
    <fo:initial-property-set font-variant="small-caps"/>
    <xsl:apply-templates/>
  </fo:block>
</xsl:template>

</xsl:stylesheet>
```

Result instance: elements and attributes in the fo: namespace:

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_alternative-copyfit-content -->
```xml
<fo:block>
  <fo:initial-property-set font-variant="small-caps">
  </fo:initial-property-set>This is the text of a paragraph that is going to be
presented with the first line in small-caps.
</fo:block>
```

### Example: Figure with a Photograph

In this example the image (an `fo:external-graphic`) is placed as a centered block-level object. The caption is centered with 10mm indents.

Input sample:

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_alternative-copyfit-content -->
```xml
<doc>
  <figure>
    <photo image="TH0317A.jpg"/>
    <caption>C'ieng Tamlung of C'ieng Mai</caption>
  </figure>
</doc>
```

XSL Stylesheet:

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_alternative-copyfit-content -->
```xml
<?xml version='1.0'?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
                xmlns:fo="http://www.w3.org/1999/XSL/Format"
                version='1.0'>

<xsl:template match="figure">
  <fo:block>
    <xsl:apply-templates/>
  </fo:block>
</xsl:template>

<xsl:template match="photo">
  <fo:block text-align="center">
    <fo:external-graphic src="'url({@image})'"/>
  </fo:block>
</xsl:template>

<xsl:template match="caption">
  <fo:block space-before="3pt" text-align="center"
    start-indent="10mm" end-indent="10mm">
    <xsl:apply-templates/>
  </fo:block>
</xsl:template>

</xsl:stylesheet>
```

fo: element and attribute tree:

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_alternative-copyfit-content -->
```xml
<fo:block>
  <fo:block text-align="center">
    <fo:external-graphic src="'url(TH0317A.jpg)'"/>
  </fo:block>

  <fo:block space-before="3pt" text-align="center" start-indent="10mm"
    end-indent="10mm">C'ieng Tamlung of C'ieng Mai</fo:block>
</fo:block>
```

### Example: Page Numbering and Page Number Reference

In this example each page has a running footer containing the word "Page" followed by the page number. The "ref" element generates the word "page" followed by the page number of the page on which the element referenced by the "refid" attribute was placed.

Input sample:

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_alternative-copyfit-content -->
```xml
<!DOCTYPE doc SYSTEM "pgref.dtd">
<doc>
  <chapter id="x"><title>Chapter</title>
    <p>Text</p>
  </chapter>
  <chapter><title>Chapter</title>
    <p>For a description of X see <ref refid="x"/>.</p>
  </chapter>
</doc>
```

XSL Stylesheet:

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_alternative-copyfit-content -->
```xml
<?xml version='1.0'?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
                xmlns:fo="http://www.w3.org/1999/XSL/Format"
                version='1.0'>

<xsl:template match="doc">
  <fo:root>
    <fo:layout-master-set>
      <fo:simple-page-master master-name="page"
        page-height="297mm" page-width="210mm"
        margin-top="20mm" margin-bottom="10mm"
        margin-left="25mm" margin-right="25mm">
        <fo:region-body
          margin-top="0mm" margin-bottom="15mm"
          margin-left="0mm" margin-right="0mm"/>
        <fo:region-after extent="10mm"/>
      </fo:simple-page-master>
    </fo:layout-master-set>
    <fo:page-sequence master-reference="page">
      <fo:static-content flow-name="xsl-region-after">
        <fo:block>
          <xsl:text>Page </xsl:text>
          <fo:page-number/>
        </fo:block>
      </fo:static-content>
      <fo:flow flow-name="xsl-region-body">
        <xsl:apply-templates/>
      </fo:flow>
    </fo:page-sequence>
  </fo:root>
</xsl:template>

<xsl:template match="chapter/title">
  <fo:block id="{generate-id(.)}">
    <xsl:number level="multiple" count="chapter" format="1. "/>
    <xsl:apply-templates/>
  </fo:block>
</xsl:template>

<xsl:template match="p">
  <fo:block>
    <xsl:apply-templates/>
  </fo:block>
</xsl:template>

<xsl:template match="ref">
  <xsl:text>page </xsl:text>
  <fo:page-number-citation refid="{generate-id(id(@refid)/title)}"/>
</xsl:template>

</xsl:stylesheet>
```

Result Instance: elements and attributes in the fo: namespace:

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_alternative-copyfit-content -->
```xml
<fo:root>
  <fo:layout-master-set>
    <fo:simple-page-master master-name="page"
      page-height="297mm" page-width="210mm"
      margin-top="20mm" margin-bottom="10mm"
      margin-left="25mm" margin-right="25mm">
      <fo:region-body margin-top="0mm" margin-bottom="15mm"
        margin-left="0mm" margin-right="0mm"/>
      <fo:region-after extent="10mm"/>
    </fo:simple-page-master>
  </fo:layout-master-set>
  <fo:page-sequence master-reference="page">
    <fo:static-content flow-name="xsl-region-after">
      <fo:block>Page <fo:page-number/>
      </fo:block>
    </fo:static-content>
    <fo:flow flow-name="xsl-region-body">
      <fo:block id="N5">1. Chapter</fo:block>
      <fo:block>Text</fo:block>
      <fo:block id="N13">2. Chapter</fo:block>
      <fo:block>For a description of X see page <fo:page-number-citation refid="N5"/>
      </fo:block>
    </fo:flow>
  </fo:page-sequence>
</fo:root>
```

### Example: Table of Contents with Leaders

In this example the table of contents is formatted with a dot leader between the heading text and the page number.

Input sample:

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_alternative-copyfit-content -->
```xml
<doc>
  <chapter><title>Chapter</title>
    <p>Text</p>
    <section><title>Section</title>
    <p>Text</p>
    </section>
    <section><title>Section</title>
    <p>Text</p>
    </section>
  </chapter>
  <chapter><title>Chapter</title>
    <p>Text</p>
    <section><title>Section</title>
    <p>Text</p>
    </section>
    <section><title>Section</title>
    <p>Text</p>
    </section>
  </chapter>
</doc>
```

XSL Stylesheet:

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_alternative-copyfit-content -->
```xml
<?xml version='1.0'?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
                xmlns:fo="http://www.w3.org/1999/XSL/Format"
                version='1.0'>

<xsl:template match="doc">
  <!-- create the table of contents -->
  <xsl:apply-templates select="chapter/title" mode="toc"/>
  <!-- do the document -->
  <xsl:apply-templates/>
</xsl:template>

<xsl:template match="chapter/title" mode="toc">
  <fo:block text-align-last="justify">
    <fo:basic-link internal-destination="{generate-id(.)}">
      <xsl:number level="multiple" count="chapter" format="1. "/>
      <xsl:apply-templates/>
    </fo:basic-link>
    <xsl:text> </xsl:text>
    <fo:leader leader-length.minimum="12pt" leader-length.optimum="40pt"
               leader-length.maximum="100%" leader-pattern="dots"/>
    <xsl:text> </xsl:text>
    <fo:page-number-citation ref-id="{generate-id(.)}"/>
  </fo:block>
  <xsl:apply-templates select="../section/title" mode="toc"/>
</xsl:template>

<xsl:template match="section/title" mode="toc">
  <fo:block start-indent="10mm" text-align-last="justify">
    <fo:basic-link internal-destination="{generate-id(.)}">
      <xsl:number level="multiple" count="chapter|section" format="1.1 "/>
      <xsl:apply-templates/>
    </fo:basic-link>
    <xsl:text> </xsl:text>
    <fo:leader leader-length.minimum="12pt" leader-length.optimum="40pt"
               leader-length.maximum="100%" leader-pattern="dots"/>
    <xsl:text> </xsl:text>
    <fo:page-number-citation ref-id="{generate-id(.)}"/>
  </fo:block>
</xsl:template>

<xsl:template match="chapter/title">
  <fo:block id="{generate-id(.)}">
    <xsl:number level="multiple" count="chapter" format="1. "/>
    <xsl:apply-templates/>
  </fo:block>
</xsl:template>

<xsl:template match="section/title">
  <fo:block id="{generate-id(.)}">
    <xsl:number level="multiple" count="chapter|section" format="1.1 "/>
    <xsl:apply-templates/>
  </fo:block>
</xsl:template>

<xsl:template match="p">
  <fo:block>
    <xsl:apply-templates/>
  </fo:block>
</xsl:template>

</xsl:stylesheet>
```

Result Instance: elements and attributes in the fo: namespace:

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_alternative-copyfit-content -->
```xml
<fo:block text-align-last="justify">
  <fo:basic-link internal-destination="N4">1. Chapter
  </fo:basic-link>
  <fo:leader leader-length.minimum="12pt" leader-length.optimum="40pt"
    leader-length.maximum="100%" leader-pattern="dots">
  </fo:leader>
  <fo:page-number-citation ref-id="N4">
  </fo:page-number-citation>
</fo:block>
<fo:block start-indent="10mm" text-align-last="justify">
  <fo:basic-link internal-destination="N11">1.1 Section
  </fo:basic-link>
  <fo:leader leader-length.minimum="12pt" leader-length.optimum="40pt"
    leader-length.maximum="100%" leader-pattern="dots">
  </fo:leader>
  <fo:page-number-citation ref-id="N11">
  </fo:page-number-citation>
</fo:block>
<fo:block start-indent="10mm" text-align-last="justify">
  <fo:basic-link internal-destination="N19">1.2 Section
  </fo:basic-link>
  <fo:leader leader-length.minimum="12pt" leader-length.optimum="40pt"
    leader-length.maximum="100%" leader-pattern="dots">
  </fo:leader>
  <fo:page-number-citation ref-id="N19">
  </fo:page-number-citation>
</fo:block>
<fo:block text-align-last="justify">
  <fo:basic-link internal-destination="N28">2. Chapter
  </fo:basic-link>
  <fo:leader leader-length.minimum="12pt" leader-length.optimum="40pt"
    leader-length.maximum="100%" leader-pattern="dots">
  </fo:leader>
  <fo:page-number-citation ref-id="N28">
  </fo:page-number-citation>
</fo:block>
<fo:block start-indent="10mm" text-align-last="justify">
  <fo:basic-link internal-destination="N35">2.1 Section
  </fo:basic-link>
  <fo:leader leader-length.minimum="12pt" leader-length.optimum="40pt"
    leader-length.maximum="100%" leader-pattern="dots">
  </fo:leader>
  <fo:page-number-citation ref-id="N35">
  </fo:page-number-citation>
</fo:block>
<fo:block start-indent="10mm" text-align-last="justify">
  <fo:basic-link internal-destination="N43">2.2 Section
  </fo:basic-link>
  <fo:leader leader-length.minimum="12pt" leader-length.optimum="40pt"
    leader-length.maximum="100%" leader-pattern="dots">
  </fo:leader>
  <fo:page-number-citation ref-id="N43">
  </fo:page-number-citation>
</fo:block>

<fo:block id="N4">1. Chapter
</fo:block>

<fo:block>Text
</fo:block>

<fo:block id="N11">1.1 Section
</fo:block>

<fo:block>Text
</fo:block>

<fo:block id="N19">1.2 Section
</fo:block>

<fo:block>Text
</fo:block>

<fo:block id="N28">2. Chapter
</fo:block>

<fo:block>Text
</fo:block>

<fo:block id="N35">2.1 Section
</fo:block>

<fo:block>Text
</fo:block>

<fo:block id="N43">2.2 Section
</fo:block>

<fo:block>Text
</fo:block>
```

## Formatting Objects for Tables

There are nine formatting objects used to construct tables: `fo:table-and-caption`, `fo:table`, `fo:table-column`, `fo:table-caption`, `fo:table-header`, `fo:table-footer`, `fo:table-body`, `fo:table-row`, and `fo:table-cell`.

Text alignment is ordinarily the same for all cells in a column, so the natural choice is to specify the `text-align` property on the `fo:table-column` and specify `text-align="from-table-column()"` on all the `fo:table-cell` objects in that column. To specify a value other than the default for a specific `fo:table-cell` in the table-column, use that value in the `text-align` property.

### Table Header and Footer on Boundaries

To specify different instances of what the table header or footer should be like depending on the different boundaries (page, column, and region), XSL-FO provides formatting objects for selecting alternative headers and footers: `fo:table-header-alternatives`, `fo:table-footer-alternatives`, `fo:conditional-table-header-reference`, and `fo:conditional-table-footer-reference`.

- `fo:table-header-alternatives` is a child object of `fo:table-header`. It does not have any properties.
- `fo:table-footer-alternatives` is a child object of `fo:table-footer`. It does not have any properties.
- `fo:conditional-table-header-reference` is a child of `fo:table-header-alternatives`. It has a `header-position` property.
- `fo:conditional-table-footer-reference` is a child of `fo:table-footer-alternatives`. It has a `footer-position` property.

The valid values for both `header-position` and `footer-position` are "page", "column", and "region". If a `fo:conditional-table-footer-reference` does not have a `header-position` or `footer-position` property, it is taken to be the default reference for the table.

Sample XSL FO snippet:

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_ruby-text-container -->
```xml
<fo:table>
 <fo:table-header>
   <fo:table-header-alternatives>
     <fo:conditional-table-header-reference>
       ...
     </fo:conditional-table-header-reference>
     <fo:conditional-table-header-reference header-position="page">
       ...
     </fo:conditional-table-header-reference>
     <fo:conditional-table-header-reference header-position="column">
       ...
     </fo:conditional-table-header-reference>
     ...
   </fo:table-header-alternatives>
 </fo:table-header>
 <fo:table-footer>
   <fo:table-footer-alternatives>
   </fo:table-footer-alternatives>
 </fo:table-footer>
 <fo:table-body>
   ...
 </fo:table-body>
</fo:table>
```

### Example: Simple Table, Centered and Indented

The table and its caption is centered in the available space. The centering and indent is not desired for the content of the caption and the cells.

Input sample:

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_ruby-text-container -->
```xml
<doc>
<table>
<caption><p>Caption for this table</p></caption>
<tgroup cols="3" width="325pt">
<colspec colwidth="100pt"/>
<colspec colwidth="150pt"/>
<colspec colwidth="75pt"/>
<tbody>
<row>
<entry><p>Cell 1</p></entry>
<entry><p>Cell 2</p></entry>
<entry><p>Cell 3</p></entry>
</row>
</tbody>
</tgroup>
</table>
</doc>
```

XSL Stylesheet:

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_ruby-text-container -->
```xml
<?xml version='1.0'?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
                xmlns:fo="http://www.w3.org/1999/XSL/Format"
                version='1.0'>

<xsl:attribute-set name="inside-table">
  <xsl:attribute name="start-indent">0pt</xsl:attribute>
  <xsl:attribute name="text-align">start</xsl:attribute>
</xsl:attribute-set>

<xsl:template match="p">
  <fo:block>
    <xsl:apply-templates/>
  </fo:block>
</xsl:template>

<xsl:template match="table">
  <fo:table-and-caption text-align="center" start-indent="100pt">
    <xsl:apply-templates/>
  </fo:table-and-caption>
</xsl:template>

<xsl:template match="caption">
  <fo:table-caption xsl:use-attribute-sets="inside-table">
    <xsl:apply-templates/>
  </fo:table-caption>
</xsl:template>

<xsl:template match="tgroup">
  <fo:table width="{@width}" table-layout="fixed">
    <xsl:apply-templates/>
  </fo:table>
</xsl:template>

<xsl:template match="colspec">
  <fo:table-column column-width="{@colwidth}">
    <xsl:attribute name="column-number">
      <xsl:number count="colspec"/>
    </xsl:attribute>
  </fo:table-column>
</xsl:template>

<xsl:template match="tbody">
  <fo:table-body xsl:use-attribute-sets="inside-table">
    <xsl:apply-templates/>
  </fo:table-body>
</xsl:template>

<xsl:template match="row">
  <fo:table-row>
    <xsl:apply-templates/>
  </fo:table-row>
</xsl:template>

<xsl:template match="entry">
  <fo:table-cell>
    <xsl:apply-templates/>
  </fo:table-cell>
</xsl:template>

</xsl:stylesheet>
```

Result Instance: elements and attributes in the fo: namespace:

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_ruby-text-container -->
```xml
<fo:table-and-caption text-align="center" start-indent="100pt">

  <fo:table-caption start-indent="0pt" text-align="start">
    <fo:block>Caption for this table
    </fo:block>
  </fo:table-caption>

  <fo:table width="325pt" table-layout="fixed">

    <fo:table-column column-width="100pt" column-number="1">
    </fo:table-column>
    <fo:table-column column-width="150pt" column-number="2">
    </fo:table-column>
    <fo:table-column column-width="75pt" column-number="3">
    </fo:table-column>

    <fo:table-body start-indent="0pt" text-align="start">

    <fo:table-row>

    <fo:table-cell>
    <fo:block>Cell 1
    </fo:block>
    </fo:table-cell>
    <fo:table-cell>
    <fo:block>Cell 2
    </fo:block>
    </fo:table-cell>
    <fo:table-cell>
    <fo:block>Cell 3
    </fo:block>
    </fo:table-cell>

    </fo:table-row>

    </fo:table-body>

  </fo:table>

</fo:table-and-caption>
```

### Example: CALS Table with Proportional Column Widths

This example shows a more complex table with CALS-style column width specifications including proportional widths, vertical alignment, and text alignment per cell.

Input sample:

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_ruby-text-container -->
```xml
<doc>
<table>
<tgroup cols="3">
<colspec colname="col1" colwidth="1*"/>
<colspec colname="col2" colwidth="2*+2pi"/>
<colspec colname="col3" colwidth="72"/>
<tbody>
<row>
<entry colnum="1" valign="top"><p>Cell 1</p></entry>
<entry colnum="2" valign="middle" align="center"><p>Cell 2</p></entry>
<entry colnum="3" align="center"><p>Cell 3</p></entry>
</row>
</tbody>
</tgroup>
</table>
</doc>
```

XSL Stylesheet (including the `calc.column.width` template for converting CALS column widths to XSL-FO):

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_ruby-text-container -->
```xml
<?xml version='1.0'?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
                xmlns:fo="http://www.w3.org/1999/XSL/Format"
                version='1.0'>

<xsl:template match="p">
  <fo:block>
    <xsl:apply-templates/>
  </fo:block>
</xsl:template>

<xsl:template match="table">
  <fo:table width="12cm" table-layout="fixed">
    <xsl:apply-templates/>
  </fo:table>
</xsl:template>

<xsl:template match="colspec">
  <fo:table-column>
    <xsl:attribute name="column-number">
      <xsl:number count="colspec"/>
    </xsl:attribute>
    <xsl:attribute name="column-width">
      <xsl:call-template name="calc.column.width">
        <xsl:with-param name="colwidth">
          <xsl:value-of select="@colwidth"/>
        </xsl:with-param>
      </xsl:call-template>
    </xsl:attribute>
  </fo:table-column>
</xsl:template>

<xsl:template match="tbody">
  <fo:table-body>
    <xsl:apply-templates/>
  </fo:table-body>
</xsl:template>

<xsl:template match="row">
  <fo:table-row>
    <xsl:apply-templates/>
  </fo:table-row>
</xsl:template>

<xsl:template match="entry">
  <fo:table-cell column-number="{@colnum}">
    <xsl:if test="@valign">
      <xsl:choose>
        <xsl:when test="@valign='middle'">
          <xsl:attribute name="display-align">center</xsl:attribute>
        </xsl:when>
        <xsl:when test="@valign='top'">
          <xsl:attribute name="display-align">before</xsl:attribute>
        </xsl:when>
        <xsl:when test="@valign='bottom'">
          <xsl:attribute name="display-align">after</xsl:attribute>
        </xsl:when>
        <xsl:otherwise>
          <xsl:attribute name="display-align">before</xsl:attribute>
        </xsl:otherwise>
      </xsl:choose>
    </xsl:if>
    <xsl:if test="@align">
      <xsl:attribute name="text-align">
        <xsl:value-of select="@align"/>
      </xsl:attribute>
    </xsl:if>
    <xsl:apply-templates/>
  </fo:table-cell>
</xsl:template>


<xsl:template name="calc.column.width">
<!-- **
     * <p>Calculate an XSL FO table column-width specification from a
     * full relative table column-width specification.</p>
     *
     * <p>Table column-widths are in the following basic
     * forms:</p>
     *
     * <ul>
     * <li><b>99.99units</b>, a fixed length-specifier.</li>
     * <li><b>99.99</b>, a fixed length-specifier without any units.</li>
     * <li><b>99.99*</b>, a relative length-specifier.</li>
     * <li><b>99.99*+99.99units</b>, a combination of both.</li>
     * </ul>
     *
     * <p>The units are points (pt), picas (pi), centimeters (cm),
     * millimeters (mm), and inches (in). These are the same units as XSL,
     * except that XSL abbreviates picas "pc" instead of "pi". If a length
     * specifier has no units, the default unit (pt) is assumed.</p>
     *
     * <p>Relative length-specifiers are represented in XSL with the
     * proportional-column-width() function.</p>
     *
     * <p>Here are some examples:</p>
     *
     * <ul>
     * <li>"36pt" becomes "36pt"</li>
     * <li>"3pi" becomes "3pc"</li>
     * <li>"36" becomes "36pt"</li>
     * <li>"3*" becomes "proportional-column-width(3)"</li>
     * <li>"3*+2pi" becomes "proportional-column-width(3)+2pc"</li>
     * <li>"1*+2" becomes "proportional-column-width(1)+2pt"</li>
     * </ul>
     *
     * @param colwidth The column width specification.
     *
     * @returns The XSL column width specification.
     * -->
  <xsl:param name="colwidth">1*</xsl:param>

  <!-- Ok, the colwidth could have any one of the following forms: -->
  <!--        1*       = proportional width -->
  <!--     1unit       = 1.0 units wide -->
  <!--         1       = 1pt wide -->
  <!--  1*+1unit       = proportional width + some fixed width -->
  <!--      1*+1       = proportional width + some fixed width -->

  <!-- If it has a proportional width, translate it to XSL -->
  <xsl:if test="contains($colwidth, '*')">
    <xsl:text>proportional-column-width(</xsl:text>
    <xsl:value-of select="substring-before($colwidth, '*')"/>
    <xsl:text>)</xsl:text>
  </xsl:if>

  <!-- Now get the non-proportional part of the specification -->
  <xsl:variable name="width-units">
    <xsl:choose>
      <xsl:when test="contains($colwidth, '*')">
        <xsl:value-of
             select="normalize-space(substring-after($colwidth, '*'))"/>
      </xsl:when>
      <xsl:otherwise>
        <xsl:value-of select="normalize-space($colwidth)"/>
      </xsl:otherwise>
    </xsl:choose>
  </xsl:variable>

  <!-- Now the width-units could have any one of the following forms: -->
  <!--                 = <empty string> -->
  <!--     1unit       = 1.0 units wide -->
  <!--         1       = 1pt wide -->
  <!-- with an optional leading sign -->

  <!-- Get the width part by blanking out the units part and discarding -->
  <!-- white space. -->
  <xsl:variable name="width"
       select="normalize-space(translate($width-units,
                                         '+-0123456789.abcdefghijklmnopqrstuvwxyz',
                                         '+-0123456789.'))"/>

  <!-- Get the units part by blanking out the width part and discarding -->
  <!-- white space. -->
  <xsl:variable name="units"
       select="normalize-space(translate($width-units,
                                         'abcdefghijklmnopqrstuvwxyz+-0123456789.',
                                         'abcdefghijklmnopqrstuvwxyz'))"/>

  <!-- Output the width -->
  <xsl:value-of select="$width"/>

  <!-- Output the units, translated appropriately -->
  <xsl:choose>
    <xsl:when test="$units = 'pi'">pc</xsl:when>
    <xsl:when test="$units = '' and $width != ''">pt</xsl:when>
    <xsl:otherwise><xsl:value-of select="$units"/></xsl:otherwise>
  </xsl:choose>
</xsl:template>

</xsl:stylesheet>
```

Result Instance: elements and attributes in the fo: namespace:

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_ruby-text-container -->
```xml
<fo:table width="12cm" table-layout="fixed">
  <fo:table-column column-number="1" column-width="proportional-column-width(1)">
  </fo:table-column>
  <fo:table-column column-number="2" column-width="proportional-column-width(2)+2pc">
  </fo:table-column>
  <fo:table-column column-number="3" column-width="72pt">
  </fo:table-column>
  <fo:table-body>
    <fo:table-row>
      <fo:table-cell column-number="1" display-align="before">
        <fo:block>Cell 1
        </fo:block>
      </fo:table-cell>
      <fo:table-cell column-number="2" display-align="center" text-align="center">
        <fo:block>Cell 2
        </fo:block>
      </fo:table-cell>
      <fo:table-cell column-number="3" text-align="center">
        <fo:block>Cell 3
        </fo:block>
      </fo:table-cell>
    </fo:table-row>
  </fo:table-body>
</fo:table>
```

## Formatting Objects for Lists

There are four formatting objects used to construct lists: `fo:list-block`, `fo:list-item`, `fo:list-item-label`, and `fo:list-item-body`.

The `fo:list-block` has the role of containing the complete list and of specifying values used for the list geometry in the inline-progression-direction.

The children of the `fo:list-block` are one or more `fo:list-item`, each containing a pair of `fo:list-item-label` and `fo:list-item-body`.

The `fo:list-item` has the role of containing each item in a list.

The `fo:list-item-label` has the role of containing the content (block-level formatting objects) of the label for the list-item; typically an `fo:block` containing a number, a dingbat character, or a term.

The `fo:list-item-body` has the role of containing the content (block-level formatting objects) of the body of the list-item; typically one or more `fo:block`.

### List Geometry

The specification of the list geometry in the inline-progression-direction is achieved by:

1. Specifying appropriate values of the `provisional-distance-between-starts` and `provisional-label-separation` properties. The `provisional-distance-between-starts` specifies the desired distance between the start-indents of the label and the body of the list-item. The `provisional-label-separation` specifies the desired separation between the `end-indent` of the label and the `start-indent` of the body of the list-item.

2. Specifying `end-indent="label-end()"` on the `fo:list-item-label`. Specifying `start-indent="body-start()"` on the `fo:list-item-body`.

The `start-indent` of the list-item-label and `end-indent` of the list-item-body, if desired, are typically specified as a length.

### Example: Enumerated List

The list-items are contained in an `"ol"` element. The items are contained in `"item"` elements and contain text (as opposed to paragraphs). The style is to enumerate the items alphabetically with a dot after the letter.

Input sample:

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_conditional-table-footer-reference -->
```xml
<ol>
<item>List item 1.</item>
<item>List item 2.</item>
<item>List item 3.</item>
</ol>
```

XSL Stylesheet:

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_conditional-table-footer-reference -->
```xml
<?xml version='1.0'?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
                xmlns:fo="http://www.w3.org/1999/XSL/Format"
                version='1.0'>

<xsl:template match="ol">
  <fo:list-block provisional-distance-between-starts="15mm"
   provisional-label-separation="5mm">
    <xsl:apply-templates/>
  </fo:list-block>
</xsl:template>

<xsl:template match="ol/item">
  <fo:list-item>
    <fo:list-item-label start-indent="5mm" end-indent="label-end()">
      <fo:block>
        <xsl:number format="a."/>
      </fo:block>
    </fo:list-item-label>
    <fo:list-item-body start-indent="body-start()">
      <fo:block>
        <xsl:apply-templates/>
      </fo:block>
    </fo:list-item-body>
  </fo:list-item>
</xsl:template>

</xsl:stylesheet>
```

Result Instance: elements and attributes in the fo: namespace:

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_conditional-table-footer-reference -->
```xml
<fo:list-block provisional-distance-between-starts="15mm"
  provisional-label-separation="5mm">

  <fo:list-item>
    <fo:list-item-label start-indent="5mm" end-indent="label-end()">
      <fo:block>a.
      </fo:block>
    </fo:list-item-label>
    <fo:list-item-body start-indent="body-start()">
      <fo:block>List item 1.
      </fo:block>
    </fo:list-item-body>
  </fo:list-item>

  <fo:list-item>
    <fo:list-item-label start-indent="5mm" end-indent="label-end()">
      <fo:block>b.
      </fo:block>
    </fo:list-item-label>
    <fo:list-item-body start-indent="body-start()">
      <fo:block>List item 2.
      </fo:block>
    </fo:list-item-body>
  </fo:list-item>

  <fo:list-item>
    <fo:list-item-label start-indent="5mm" end-indent="label-end()">
      <fo:block>c.
      </fo:block>
    </fo:list-item-label>
    <fo:list-item-body start-indent="body-start()">
      <fo:block>List item 3.
      </fo:block>
    </fo:list-item-body>
  </fo:list-item>

</fo:list-block>
```

### Example: HTML-style Definition Lists

This example processes HTML-style `"dl"` lists, which contain unwrapped pairs of `"dt"` and `"dd"` elements, transforming them into `fo:list-block`s. Balanced pairs of `"dt"`/`"dd"`s are converted into `fo:list-item`s. For unbalanced `"dt"`/`"dd"`s, the stylesheet makes the following assumptions:

- Multiple `"dt"`s are grouped together into a single `fo:list-item-label` in a single list-item.
- Multiple `"dd"`s are output as individual FO list-items with an empty list-item-label if the stylesheet variable `$allow-naked-dd` is `true`, or are grouped together into a single FO list-item-body if `$allow-naked-dd` is `false`.

Input sample:

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_conditional-table-footer-reference -->
```xml
<doc>
<dl>
  <dt>term</dt>
  <dd>definition</dd>
  <dt>term</dt>
  <dt>term</dt>
  <dd>definition</dd>
  <dt>term</dt>
  <dd>definition</dd>
  <dd>definition</dd>
</dl>
</doc>
```

If `$allow-naked-dd` is `true`, the result instance: elements and attributes in the fo: namespace is:

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_conditional-table-footer-reference -->
```xml
<fo:list-block provisional-distance-between-starts="35mm"
  provisional-label-separation="5mm">
  <fo:list-item>
    <fo:list-item-label end-indent="label-end()">
      <fo:block>term
      </fo:block>
    </fo:list-item-label>
    <fo:list-item-body start-indent="body-start()">
      <fo:block>definition
      </fo:block>
    </fo:list-item-body>
  </fo:list-item>
  <fo:list-item>
    <fo:list-item-label end-indent="label-end()">
      <fo:block>term
      </fo:block>
      <fo:block>term
      </fo:block>
    </fo:list-item-label>
    <fo:list-item-body start-indent="body-start()">
      <fo:block>definition
      </fo:block>
    </fo:list-item-body>
  </fo:list-item>
  <fo:list-item>
    <fo:list-item-label end-indent="label-end()">
      <fo:block>term
      </fo:block>
    </fo:list-item-label>
    <fo:list-item-body start-indent="body-start()">
      <fo:block>definition
      </fo:block>
    </fo:list-item-body>
  </fo:list-item>
  <fo:list-item>
    <fo:list-item-label end-indent="label-end()">
    </fo:list-item-label>
    <fo:list-item-body start-indent="body-start()">
      <fo:block>definition
      </fo:block>
    </fo:list-item-body>
  </fo:list-item>
</fo:list-block>
```

If `$allow-naked-dd` is `false`, the result instance: elements and attributes in the fo: namespace is:

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_conditional-table-footer-reference -->
```xml
<fo:list-block provisional-distance-between-starts="35mm"
  provisional-label-separation="5mm">
  <fo:list-item>
    <fo:list-item-label end-indent="label-end()">
      <fo:block>term
      </fo:block>
    </fo:list-item-label>
    <fo:list-item-body start-indent="body-start()">
      <fo:block>definition
      </fo:block>
    </fo:list-item-body>
  </fo:list-item>
  <fo:list-item>
    <fo:list-item-label end-indent="label-end()">
      <fo:block>term
      </fo:block>
      <fo:block>term
      </fo:block>
    </fo:list-item-label>
    <fo:list-item-body start-indent="body-start()">
      <fo:block>definition
      </fo:block>
    </fo:list-item-body>
  </fo:list-item>
  <fo:list-item>
    <fo:list-item-label end-indent="label-end()">
      <fo:block>term
      </fo:block>
    </fo:list-item-label>
    <fo:list-item-body start-indent="body-start()">
      <fo:block>definition
      </fo:block>
      <fo:block>definition
      </fo:block>
    </fo:list-item-body>
  </fo:list-item>
</fo:list-block>
```

XSL Stylesheet:

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_conditional-table-footer-reference -->
```xml
<?xml version='1.0'?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
                xmlns:fo="http://www.w3.org/1999/XSL/Format"
                version='1.0'>

<xsl:include href="dtdd.xsl"/>

<xsl:template match="doc">
  <xsl:apply-templates/>
</xsl:template>

<xsl:template match="dl">
  <xsl:call-template name="process.dl"/>
</xsl:template>

<xsl:template match="dt|dd">
  <fo:block>
    <xsl:apply-templates/>
  </fo:block>
</xsl:template>

</xsl:stylesheet>
```

Included stylesheet "dtdd.xsl":

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_conditional-table-footer-reference -->
```xml
<?xml version='1.0'?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
                xmlns:fo="http://www.w3.org/1999/XSL/Format"
                version='1.0'>

<xsl:variable name="allow-naked-dd" select="true()"/>

<xsl:template name="process.dl">
  <fo:list-block provisional-distance-between-starts="35mm"
   provisional-label-separation="5mm">
    <xsl:choose>
      <xsl:when test="$allow-naked-dd">
        <xsl:call-template name="process.dl.content.with.naked.dd"/>
      </xsl:when>
      <xsl:otherwise>
        <xsl:call-template name="process.dl.content"/>
      </xsl:otherwise>
    </xsl:choose>
  </fo:list-block>
</xsl:template>

<xsl:template name="process.dl.content.with.naked.dd">
  <xsl:param name="dts" select="./force-list-to-be-empty"/>
  <xsl:param name="nodes" select="*"/>

  <xsl:choose>
    <xsl:when test="count($nodes)=0">
      <!-- Out of nodes, output any pending DTs -->
      <xsl:if test="count($dts)>0">
        <fo:list-item>
          <fo:list-item-label end-indent="label-end()">
            <xsl:apply-templates select="$dts"/>
          </fo:list-item-label>
          <fo:list-item-body start-indent="body-start()"/>
        </fo:list-item>
      </xsl:if>
    </xsl:when>

    <xsl:when test="name($nodes[1])='dd'">
      <!-- We found a DD, output the DTs and the DD -->
      <fo:list-item>
        <fo:list-item-label end-indent="label-end()">
          <xsl:apply-templates select="$dts"/>
        </fo:list-item-label>
        <fo:list-item-body start-indent="body-start()">
          <xsl:apply-templates select="$nodes[1]"/>
        </fo:list-item-body>
      </fo:list-item>
      <xsl:call-template name="process.dl.content.with.naked.dd">
        <xsl:with-param name="nodes" select="$nodes[position()>1]"/>
      </xsl:call-template>
    </xsl:when>

    <xsl:when test="name($nodes[1])='dt'">
      <!-- We found a DT, add it to the list of DTs and loop -->
      <xsl:call-template name="process.dl.content.with.naked.dd">
        <xsl:with-param name="dts" select="$dts|$nodes[1]"/>
        <xsl:with-param name="nodes" select="$nodes[position()>1]"/>
      </xsl:call-template>
    </xsl:when>

    <xsl:otherwise>
      <!-- This shouldn't happen -->
      <xsl:message>
        <xsl:text>DT/DD list contained something bogus (</xsl:text>
        <xsl:value-of select="name($nodes[1])"/>
        <xsl:text>).</xsl:text>
      </xsl:message>
    </xsl:otherwise>
  </xsl:choose>
</xsl:template>

<xsl:template name="process.dl.content">
  <xsl:param name="dts" select="./force-list-to-be-empty"/>
  <xsl:param name="dds" select="./force-list-to-be-empty"/>
  <xsl:param name="output-on"></xsl:param>
  <xsl:param name="nodes" select="*"/>

  <!-- The algorithm here is to build up a list of DTs and DDs, -->
  <!-- outputing them only on the transition from DD back to DT -->

  <xsl:choose>
    <xsl:when test="count($nodes)=0">
      <!-- Out of nodes, output any pending elements -->
      <xsl:if test="count($dts)>0 or count($dds)>0">
        <fo:list-item>
          <fo:list-item-label end-indent="label-end()">
            <xsl:apply-templates select="$dts"/>
          </fo:list-item-label>
          <fo:list-item-body start-indent="body-start()">
            <xsl:apply-templates select="$dds"/>
          </fo:list-item-body>
        </fo:list-item>
      </xsl:if>
    </xsl:when>

    <xsl:when test="name($nodes[1])=$output-on">
      <!-- We're making the transition from DD back to DT -->
      <fo:list-item>
        <fo:list-item-label end-indent="label-end()">
          <xsl:apply-templates select="$dts"/>
        </fo:list-item-label>
        <fo:list-item-body start-indent="body-start()">
          <xsl:apply-templates select="$dds"/>
        </fo:list-item-body>
      </fo:list-item>

      <!-- Reprocess this node (and the rest of the node list) -->
      <!-- resetting the output-on state to nil -->
      <xsl:call-template name="process.dl.content">
        <xsl:with-param name="nodes" select="$nodes"/>
      </xsl:call-template>
    </xsl:when>

    <xsl:when test="name($nodes[1])='dt'">
      <!-- We found a DT, add it to the list and loop -->
      <xsl:call-template name="process.dl.content">
        <xsl:with-param name="dts" select="$dts|$nodes[1]"/>
        <xsl:with-param name="dds" select="$dds"/>
        <xsl:with-param name="nodes" select="$nodes[position()>1]"/>
      </xsl:call-template>
    </xsl:when>

    <xsl:when test="name($nodes[1])='dd'">
      <!-- We found a DD, add it to the list and loop, noting that -->
      <!-- the next time we cross back to DT's, we need to output the -->
      <!-- current DT/DDs. -->
      <xsl:call-template name="process.dl.content">
        <xsl:with-param name="dts" select="$dts"/>
        <xsl:with-param name="dds" select="$dds|$nodes[1]"/>
        <xsl:with-param name="output-on">dt</xsl:with-param>
        <xsl:with-param name="nodes" select="$nodes[position()>1]"/>
      </xsl:call-template>
    </xsl:when>

    <xsl:otherwise>
      <!-- This shouldn't happen -->
      <xsl:message>
        <xsl:text>DT/DD list contained something bogus (</xsl:text>
        <xsl:value-of select="name($nodes[1])"/>
        <xsl:text>).</xsl:text>
      </xsl:message>
    </xsl:otherwise>
  </xsl:choose>
</xsl:template>

</xsl:stylesheet>
```

## Formatting Objects for Bookmarks

The `fo:bookmark-tree` formatting object is used to hold a list of access points within the document such as a table of contents, a list of figures or tables, etc. Each access point is called a bookmark.

The `fo:bookmark` formatting object is used to identify an access point, by name, and to specify where that access point is within the current document or another external document. A given bookmark may be further subdivided into a sequence of (sub-)bookmarks to as many levels as the authors desire. The `fo:bookmark` is a specialized form of the `fo:basic-link` with restrictions on the applicable properties and on its content model.

One of the `external-destination` and `internal-destination` properties should be specified on `fo:bookmark`. If both are specified, the system may either report it as an error, or use the `internal-destination` property. The property `starting-state` determines whether any sub-list of bookmarks is initially displayed or is hidden. The value "show" means include the sub-list; the value "hide" means show only this bookmark.

The `fo:bookmark-title` formatting object is used to identify, in human readable form, an access point. It is a specialized form of `fo:inline` with restrictions on the applicable properties and on its content model.

## Out-of-Line Formatting Objects

### Floats

The `fo:float` formatting object is used for two distinct purposes.

First, so that during the normal placement of content, some related content is formatted into a separate area at the beginning of a page where it is available to be read without immediately intruding on the reader. The areas generated by this kind of `fo:float` are called **before-floats**. An `fo:float` is specified to generate before-floats if it has a `float` property value of "before". The constraints on placing before-floats on a page are described in the Conditional Sub-Regions section and in the description of the `fo:float` formatting object.

Second, the `fo:float` formatting object is used when an area is intended to float to one side, with normal content flowing alongside the floated area. The areas generated by this kind of `fo:float` are called **side-floats**. A side-float is always made a child of the nearest ancestor reference-area. The edge of the reference-area towards which the side-float floats is controlled by the value of the `float` property.

Flowing normal content alongside side-floats is realized by increasing the start-intrusion-adjustment or the end-intrusion-adjustment of normal child areas of the parent reference-area of the side-float.

The `clear` property applies to any block-level formatting object. If the value of this property for a particular formatting object is any value other than "none", then the areas generated by the block will be positioned to ensure that their border-rectangles do not overlap the allocation-rectangles of the applicable side-floats as determined by the `clear` property value.

### Footnotes

The `fo:footnote` formatting object is used to generate both a footnote and its citation. The `fo:footnote` has two children, which are both required to be present. The first child is an `fo:inline` formatting object, which is formatted to produce the footnote citation. The second child is an `fo:footnote-body` formatting object which generates the content (or body) of the footnote.

The actual areas generated by the descendants of the `fo:footnote-body` formatting object are determined by the formatting objects that comprise the descendant subtree. For example, the footnote could be formatted with a label and an indented body by using the `fo:list-block` formatting object within the `fo:footnote-body`.

### Conditional Sub-Regions

The region-body has two conditional sub-regions which implicitly specify corresponding reference-areas called **before-float-reference-area** and **footnote-reference-area**. These reference-areas are conditionally generated as children of the region-reference-area. The before-float-reference-area is generated only if the page contains one or more areas with area-class "xsl-before-float". The footnote-reference-area is generated only if the page contains one or more areas with area-class "xsl-footnote".

The conditionally generated areas borrow space in the block-progression-dimension within the region-reference-area, at the expense of the main-reference-area. Whether or not a conditionally generated area is actually generated depends, additionally, on whether there is sufficient space left in the main-reference-area.

If there is an `fo:static-content` in a page-sequence whose `flow-name` property value is "xsl-before-float-separator", then the areas returned by formatting the `fo:static-content` are inserted as the last children of a before-float-reference-area, provided the main-reference-area on the page is not empty.

If there is an `fo:static-content` whose `flow-name` property value is "xsl-footnote-separator", then the areas returned by formatting the `fo:static-content` are inserted as the initial children of a footnote-reference-area.

### Example: Floating Figure

Input sample:

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_bookmark-title -->
```xml
<doc>
  <p>C'ieng pieces were made in northern towns, such as C'ieng Mai.
They were typically of tamlung weight.</p>
  <figure>
    <photo image="TH0317A.jpg"/>
    <caption>C'ieng Tamlung of C'ieng Mai</caption>
  </figure>
</doc>
```

In this example the figures are placed as floats at the before side (top in a lr-tb writing-mode).

XSL Stylesheet:

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_bookmark-title -->
```xml
<?xml version='1.0'?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
                xmlns:fo="http://www.w3.org/1999/XSL/Format"
                version='1.0'>

<xsl:template match="p">
  <fo:block>
    <xsl:apply-templates/>
  </fo:block>
</xsl:template>

<xsl:template match="figure">
  <fo:float float="before">
    <xsl:apply-templates/>
  </fo:float>
</xsl:template>

<xsl:template match="photo">
  <fo:block text-align="center">
    <fo:external-graphic src="{@image}"/>
  </fo:block>
</xsl:template>

<xsl:template match="caption">
  <fo:block space-before="3pt" text-align="center"
    start-indent="10mm" end-indent="10mm">
    <xsl:apply-templates/>
  </fo:block>
</xsl:template>

</xsl:stylesheet>
```

Result Instance: elements and attributes in the fo: namespace:

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_bookmark-title -->
```xml
<fo:block>C'ieng pieces were made in northern towns,
such as C'ieng Mai. They were typically of tamlung weight.
</fo:block>

<fo:float float="before">

  <fo:block text-align="center">
    <fo:external-graphic src="TH0317A.jpg">
    </fo:external-graphic>
  </fo:block>

  <fo:block space-before="3pt" text-align="center" start-indent="10mm"
    end-indent="10mm">C'ieng Tamlung of C'ieng Mai
  </fo:block>

</fo:float>
```

### Example: Footnote

Input sample:

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_bookmark-title -->
```xml
<doc>
  <p>Some Pod Duang were restruck<fn>Berglund, A., Thai Money, from
Earliest Times to King Rama V, p. 203.</fn> during the reign of King Rama V.</p>
</doc>
```

XSL Stylesheet:

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_bookmark-title -->
```xml
<?xml version='1.0'?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
                xmlns:fo="http://www.w3.org/1999/XSL/Format"
                version='1.0'>

<xsl:template match="p">
  <fo:block>
    <xsl:apply-templates/>
  </fo:block>
</xsl:template>

<xsl:template match="fn">
  <fo:footnote>
    <fo:inline font-size="0.83em" baseline-shift="super">
      <xsl:number level="any" count="fn" format="1)"/>
    </fo:inline>
    <fo:footnote-body>
      <fo:list-block provisional-distance-between-starts="20pt"
          provisional-label-separation="5pt">
        <fo:list-item>
          <fo:list-item-label end-indent="label-end()">
            <fo:block  font-size="0.83em"
                       line-height="0.9em">
              <xsl:number level="any" count="fn" format="1)"/>
            </fo:block>
          </fo:list-item-label>
          <fo:list-item-body start-indent="body-start()">
            <fo:block  font-size="0.83em"
                       line-height="0.9em">
              <xsl:apply-templates/>
            </fo:block>
          </fo:list-item-body>
        </fo:list-item>
      </fo:list-block>
    </fo:footnote-body>
  </fo:footnote>
</xsl:template>

</xsl:stylesheet>
```

Result Instance: elements and attributes in the fo: namespace:

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_bookmark-title -->
```xml
<fo:block>Some Pod Duang were restruck
  <fo:footnote>
    <fo:inline font-size="0.83em" baseline-shift="super">1)
    </fo:inline>
    <fo:footnote-body>
    <fo:list-block provisional-distance-between-starts="20pt"
      provisional-label-separation="5pt">
    <fo:list-item>
    <fo:list-item-label end-indent="label-end()">
    <fo:block font-size="0.83em" line-height="0.9em">1)
    </fo:block>
    </fo:list-item-label>
    <fo:list-item-body start-indent="body-start()">
    <fo:block font-size="0.83em" line-height="0.9em">Berglund, A.,
Thai Money, from Earliest Times to King Rama V, p. 203.
    </fo:block>
    </fo:list-item-body>
    </fo:list-item>
    </fo:list-block>
    </fo:footnote-body>
  </fo:footnote> during the reign of King Rama V.
</fo:block>
```

## Other Formatting Objects

### Example: Wrapper

The following example shows the use of the `fo:wrapper` formatting object that has no semantics but acts as a "carrier" for inherited properties. The "emph" elements are to be presented using a bold font and the "code" elements using a Courier font.

Input sample:

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_footnote-body -->
```xml
<doc>
<p>This is an <emph>important word</emph> in this
sentence that also refers to a <code>variable</code>.</p>
</doc>
```

XSL Stylesheet:

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_footnote-body -->
```xml
<?xml version='1.0'?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
                xmlns:fo="http://www.w3.org/1999/XSL/Format"
                version='1.0'>

<xsl:template match="p">
  <fo:block>
    <xsl:apply-templates/>
  </fo:block>
</xsl:template>

<xsl:template match="emph">
  <fo:wrapper font-weight="bold">
    <xsl:apply-templates/>
  </fo:wrapper>
</xsl:template>

<xsl:template match="code">
  <fo:wrapper font-family="Courier">
    <xsl:apply-templates/>
  </fo:wrapper>
</xsl:template>

</xsl:stylesheet>
```

fo: element and attribute tree:

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_footnote-body -->
```xml
<fo:block xmlns:fo="http://www.w3.org/1999/XSL/Format">This is an
<fo:wrapper font-weight="bold">important word</fo:wrapper>
in this sentence that also refers to a
<fo:wrapper font-family="Courier">variable</fo:wrapper>.
</fo:block>
```

### Example: Table Markers (retrieve-table-marker)

The following example shows how to use the `fo:retrieve-table-marker` formatting object to create a "Table continued..." caption that appears at the bottom of the table when the table continues on the next page (assuming enough data is present that page breaks are generated). It will also show the subtotal at the bottom of the page when the table continues on the next page, and the grand total at the end of the table.

Input sample:

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_footnote-body -->
```xml
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<numbers>
  <number>1</number>
  <number>2</number>
  <!-- and so on... -->
  <number>11</number>
  <number>12</number>
</numbers>
```

XSL Stylesheet:

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_footnote-body -->
```xml
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
xmlns:fo="http://www.w3.org/1999/XSL/Format" version="1.0">
  <xsl:strip-space elements="*"/>

  <xsl:template match="numbers">
    <fo:table>
      <fo:table-column/>
      <fo:table-footer>
        <fo:table-row>
          <fo:table-cell font-weight="bold">
            <fo:block>
 <fo:retrieve-table-marker retrieve-class-name="subtotal-caption"
retrieve-position-within-table="last-ending"/>
 <fo:retrieve-table-marker retrieve-class-name="subtotal"
retrieve-position-within-table="last-ending"/>
            </fo:block>
          </fo:table-cell>
        </fo:table-row>
        <fo:retrieve-table-marker retrieve-class-name="continued"
          retrieve-position-within-table="last-ending"/>
      </fo:table-footer>
      <fo:table-body>
        <fo:marker marker-class-name="continued">
          <fo:table-row>
            <fo:table-cell>
              <fo:block>Table continued...</fo:block>
            </fo:table-cell>
          </fo:table-row>
        </fo:marker>
        <fo:marker marker-class-name="subtotal-caption">
                Subtotal:
        </fo:marker>
        <xsl:apply-templates/>
      </fo:table-body>
    </fo:table>
  </xsl:template>

  <xsl:template match="number">
    <fo:table-row>
      <fo:marker marker-class-name="subtotal">
        <xsl:value-of select="sum(preceding::number)+text()"/>
      </fo:marker>
      <xsl:if test="position() = last()">
        <fo:marker marker-class-name="continued"/>
        <fo:marker marker-class-name="subtotal-caption">
          Total:
        </fo:marker>
      </xsl:if>
      <fo:table-cell>
        <fo:block>
          <xsl:apply-templates/>
        </fo:block>
      </fo:table-cell>
    </fo:table-row>
  </xsl:template>

</xsl:stylesheet>
```

Result Instance: elements and attributes in the fo: namespace:

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_footnote-body -->
```xml
<?xml version="1.0" encoding="UTF-8"?>
<fo:table>
  <fo:table-column/>
  <fo:table-footer>
    <fo:table-row>
      <fo:table-cell font-weight="bold">
        <fo:block>
          <fo:retrieve-table-marker
            retrieve-position-within-table="last-ending"
            retrieve-class-name="subtotal-caption"/>
          <fo:retrieve-table-marker
            retrieve-position-within-table="last-ending"
            retrieve-class-name="subtotal"/>
        </fo:block>
      </fo:table-cell>
    </fo:table-row>
    <fo:retrieve-table-marker retrieve-class-name="continued"
      retrieve-position-within-table="last-ending"/>
  </fo:table-footer>
  <fo:table-body>
    <fo:marker marker-class-name="continued">
      <fo:table-row>
        <fo:table-cell>
          <fo:block>Table continued...</fo:block>
        </fo:table-cell>
      </fo:table-row>
    </fo:marker>
    <fo:marker marker-class-name="subtotal-caption">
      Subtotal:
    </fo:marker>
    <fo:table-row>
      <fo:marker marker-class-name="subtotal">1</fo:marker>
      <fo:table-cell>
        <fo:block>1</fo:block>
      </fo:table-cell>
    </fo:table-row>
    <fo:table-row>
      <fo:marker marker-class-name="subtotal">3</fo:marker>
      <fo:table-cell>
        <fo:block>2</fo:block>
      </fo:table-cell>
    </fo:table-row>
    <!-- and so on... -->
    <fo:table-row>
      <fo:marker marker-class-name="subtotal">66</fo:marker>
      <fo:table-cell>
        <fo:block>11</fo:block>
      </fo:table-cell>
    </fo:table-row>
    <fo:table-row>
      <fo:marker marker-class-name="subtotal">78</fo:marker>
      <fo:marker marker-class-name="continued"/>
      <fo:marker marker-class-name="subtotal-caption">
        Total:
      </fo:marker>
      <fo:table-cell>
        <fo:block>12</fo:block>
      </fo:table-cell>
    </fo:table-row>
  </fo:table-body>
</fo:table>
```

### Example: retrieve-table-marker Scope

The following example shows how the retrieve-table-marker functions and how the retrieve scope area set gets determined depending on the properties specified on the `fo:retrieve-table-marker`. Consider this XSL-FO result instance with a two-column layout:

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_footnote-body -->
```xml
<fo:root xmlns:fo=http://www.w3.org/1999/XSL/Format>
  <fo:layout-master-set>
    <fo:simple-page-master master-name="page ">
      <fo:region-body region-name=" body"  column-count="2"/>
    </fo:simple-page-master>
  </fo:layout-master-set>
  <fo:page-sequence master-reference="page"
    <fo:flow flow-name=" body">
      <fo:table>
        <fo:table-column/>
        <fo:table-header>...</fo:table-header>
          <fo:table-footer>
            <fo:table-row>
              <fo:table-cell>
                <fo:block>
                  <fo:retrieve-table-marker
                    retrieve-class-name="marker-name"
                    retrieve-position-within-table="See table for values..."
                    retrieve-boundary-within-table="See table for values..."/>
                </fo:block>
              </fo:table-cell>
            </fo:table-row>
        </fo:table-footer>
        <fo:table-body>
          <fo:table-row>
            <fo:table-cell>
              <!-- cell 1 -->
              <fo:marker marker-class-name="marker-name">
                <!-- marker 1 -->
                ...
              </fo:marker>
              ...
            </fo:table-cell>
          </fo:table-row>
          <!-- and so on ... -->
          <fo:table-row>
            <fo:table-cell>
              <!-- cell 14 -->
              <fo:marker marker-class-name="marker-name">
                <!-- marker 14 -->
                ...
              </fo:marker>
              ...
            </fo:table-cell>
          </fo:table-row>
        </fo:table-body>
      </fo:table>
    </fo:flow>
  </fo:page-sequence>
</fo:root>
```

## Conformance Levels

The specification defines conformance levels for formatting objects across visual and aural media:

### Out-of-Line Formatting Objects

| Formatting Object | Visual | Aural |
|---|---|---|
| `fo:float` | extended (fallback: place inline) | extended (fallback: place inline) |
| `fo:footnote` | extended (fallback: place inline) | extended (fallback: place inline) |
| `fo:footnote-body` | extended (fallback: place inline) | extended (fallback: place inline) |

### Formatting Objects for Bookmarks

| Formatting Object | Visual | Aural |
|---|---|---|
| `fo:bookmark-tree` | extended (fallback: display indication that content cannot be correctly rendered) | extended (fallback: speak an indication that content cannot be correctly spoken) |
| `fo:bookmark` | extended (fallback: ignore) | extended (fallback: ignore) |
| `fo:bookmark-title` | extended (fallback: ignore) | extended (fallback: ignore) |

### Other Formatting Objects

| Formatting Object | Visual | Aural |
|---|---|---|
| `fo:change-bar-begin` | extended (fallback: ignore) | extended (fallback: ignore) |
| `fo:change-bar-end` | extended (fallback: ignore) | extended (fallback: ignore) |
| `fo:wrapper` | basic | basic |
| `fo:marker` | extended (fallback: ignore) | extended (fallback: ignore) |
| `fo:retrieve-marker` | extended (fallback: display indication that content cannot be correctly rendered) | extended (fallback: speak an indication that content cannot be correctly rendered) |
| `fo:retrieve-table-marker` | extended (fallback: display indication that content cannot be correctly rendered) | extended (fallback: speak an indication that content cannot be correctly rendered) |

## See Also

- [fo-block.md](fo-block.md) -- The primary block-level formatting object
- [fo-inline.md](fo-inline.md) -- The primary inline-level formatting object
- [fo-table.md](fo-table.md) -- The table formatting object
- [fo-list-block.md](fo-list-block.md) -- The list formatting object
- [fo-float.md](fo-float.md) -- The float formatting object
- [fo-footnote.md](fo-footnote.md) -- The footnote formatting object
- [fo-wrapper.md](fo-wrapper.md) -- The wrapper formatting object
- [fo-basic-link.md](fo-basic-link.md) -- The basic-link formatting object
- [fo-external-graphic.md](fo-external-graphic.md) -- The external-graphic formatting object
- [fo-page-number.md](fo-page-number.md) -- The page-number formatting object
- [fo-page-number-citation.md](fo-page-number-citation.md) -- The page-number-citation formatting object
- [fo-leader.md](fo-leader.md) -- The leader formatting object
- [fo-marker.md](fo-marker.md) -- The marker formatting object
- [fo-retrieve-table-marker.md](fo-retrieve-table-marker.md) -- The retrieve-table-marker formatting object
- [guide-formatting-intro.md](guide-formatting-intro.md) -- Introduction to XSL-FO formatting concepts
- [guide-area-model.md](guide-area-model.md) -- The XSL-FO area model
