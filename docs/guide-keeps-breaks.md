# Keeps and Breaks

## Overview

Keeps and breaks are constraints that control how formatting objects are distributed across context-areas such as pages, columns, and lines. Break conditions force content to start at the beginning of a new context-area, while keep conditions prevent content from being split across context-area boundaries. Understanding how these constraints interact with the area model is essential for controlling pagination and line-breaking behavior in XSL-FO.

<!-- Source: https://www.w3.org/TR/xslfo20/#keepbreak -->

## Context and Context-Areas

Keep and break conditions apply to a class of areas referred to as a **context**. An area in this class is a **context-area**. The typical context-area classes are:

- **Page-reference-areas** -- areas generated by an `fo:page-sequence` using the specifications in an `fo:page-master`.
- **Column-areas** -- normal-flow-reference-areas generated from a region-body, or region-reference-areas generated from other types of region-master.
- **Line-areas** -- lines generated during inline formatting.

## Leading and Trailing Areas

Keep and break conditions are defined in terms of **leading** and **trailing** areas within a context-area.

If area `A` is a descendant of area `P`, then:

- `A` is **leading** in `P` if `A` has no preceding sibling which is a normal area, nor does any of its ancestor areas up to but not including `P`.
- `A` is **trailing** in `P` if `A` has no following sibling which is a normal area, nor does any of its ancestor areas up to but not including `P`.

The **next** formatting object in the flow (relative to a given formatting object) is the first formatting object following in the pre-order traversal order which is not a descendant of the given formatting object and which generates and returns normal areas.

## Break Conditions

Break conditions are either `break-before` or `break-after` conditions:

- A **`break-before`** condition is **satisfied** if the first area generated and returned by the formatting object is leading within a context-area.
- A **`break-after`** condition depends on the next formatting object in the flow. The condition is satisfied if either there is no such next formatting object, or if the first normal area generated and returned by that formatting object is leading in a context-area.

### Break Condition Values

Break conditions are imposed by the `break-before` and `break-after` properties. The refined value determines the context:

| Value | Context |
|---|---|
| `page` | Page-reference-areas |
| `even-page` | Even-numbered page-reference-areas |
| `odd-page` | Odd-numbered page-reference-areas |
| `column` | Column-areas |
| `auto` | No break condition imposed |

## Keep Conditions

Keep conditions are either `keep-with-previous`, `keep-with-next`, or `keep-together` conditions:

- A **`keep-with-previous`** condition on an object is satisfied if the first area generated and returned by the formatting object is not leading within a context-area, or if there are no preceding areas in a post-order traversal of the area tree.
- A **`keep-with-next`** condition is satisfied if the last area generated and returned by the formatting object is not trailing within a context-area, or if there are no following areas in a pre-order traversal of the area tree.
- A **`keep-together`** condition is satisfied if all areas generated and returned by the formatting object are descendants of a single context-area.

### Keep Condition Components and Strength

Keep conditions are imposed by the `within-page`, `within-column`, and `within-line` components of the `keep-with-previous`, `keep-with-next`, and `keep-together` properties:

| Component | Context |
|---|---|
| `within-page` | Page-reference-areas |
| `within-column` | Column-areas |
| `within-line` | Line-areas |

The refined value of each component specifies the **strength** of the keep condition:

- Higher numbers are stronger than lower numbers.
- The value `always` is stronger than all numeric values.
- A component with value `auto` does not impose a keep condition.

## Constraint Resolution

The area tree is constrained to satisfy **all** break conditions imposed.

Each keep condition must also be satisfied, except when this would cause a break condition or a stronger keep condition to fail to be satisfied. If not all of a set of keep conditions of equal strength can be satisfied, then some **maximal satisfiable subset** of conditions of that strength must be satisfied, together with all break conditions and maximal subsets of stronger keep conditions, if any.

In other words, the priority order is:

1. Break conditions (always satisfied)
2. Stronger keep conditions (satisfied before weaker ones)
3. Weaker keep conditions (satisfied to the extent possible without violating higher-priority constraints)

## Code Samples

No code samples in spec for this section.

## See Also

- [properties-keeps-breaks.md](properties-keeps-breaks.md) -- Property definitions for `keep-together`, `keep-with-previous`, `keep-with-next`, `break-before`, and `break-after`
- [guide-area-model.md](guide-area-model.md) -- Area model concepts including context-areas, leading/trailing definitions, and area tree structure
- [guide-datatypes.md](guide-datatypes.md) -- The `<keep>` compound datatype used by keep properties
- [guide-spaces-conditionality.md](guide-spaces-conditionality.md) -- Space resolution rules that interact with page and column boundaries
