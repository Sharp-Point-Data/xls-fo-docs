# Indexing Properties

<!-- Source: https://www.w3.org/TR/xslfo20/#index-class -->

## Overview

The indexing properties control the generation and formatting of back-of-book indexes in XSL-FO documents. These properties work in conjunction with the indexing formatting objects (`fo:index-page-citation-list`, `fo:index-key-reference`, `fo:index-range-begin`, `fo:index-range-end`, etc.) to associate index keys with content, generate page number citations, control how page numbers are merged into ranges, and manage cross-references between index key references.

The indexing system uses a key-based model: content is tagged with `index-key` values, and `fo:index-key-reference` elements cite all pages where a given key appears. The merge properties control how sequential page numbers, page ranges, and cross-key-reference citations are consolidated.

## Properties

### index-class

| Field | Value |
|---|---|
| **Values** | `<string>` |
| **Initial** | `empty string` |
| **Applies to** | any FO with index-key specified |
| **Inherited** | No |
| **Percentages** | N/A |

Associates an index class with a formatting object that also has an index key specified.

All elements with an index class that is an empty string are in the same index class. That class is distinct from all other classes.

The `index-class` property is ignored on any formatting object for which an `index-key` property has not been specified.

Index class values enable control over how page numbers are merged into ranges. Page numbers from different classes are not merged so specifying an index class can be used to control, for example, whether a range of pages crossing from the preface into the first chapter will be rendered as "vi-14" or "vi-xx, 1-14".

### index-key

| Field | Value |
|---|---|
| **Values** | `<string>` |
| **Initial** | `none` |
| **Applies to** | fo:wrapper, fo:index-range-begin, and other FOs |
| **Inherited** | No |
| **Percentages** | N/A |

Associates an index key with the formatting object on which it is specified.

All index keys with the same value identify the same index item for the purpose of generating lists of page number citations.

### ref-index-key

| Field | Value |
|---|---|
| **Values** | `<string>` |
| **Initial** | none, value required |
| **Applies to** | fo:index-key-reference |
| **Inherited** | No |
| **Percentages** | N/A |

References an index key.

Reference to the objects having an `index-key` trait equal to the specified `ref-index-key`. It is an error if there are no formatting objects with the specified index key.

### merge-ranges-across-index-key-references

| Field | Value |
|---|---|
| **Values** | `merge \| leave-separate` |
| **Initial** | `merge` |
| **Applies to** | fo:index-page-citation-list |
| **Inherited** | Yes |
| **Percentages** | N/A |

Specifies whether or not consecutive page numbers from different `fo:index-key-reference` formatting objects are to be merged into single ranges.

Values have the following meanings:

- **merge** -- Merge consecutive page numbers into ranges regardless of which `fo:index-key-reference` formatting objects referred to them.
- **leave-separate** -- Do not merge ranges across `fo:index-key-reference` formatting objects.

### merge-sequential-page-numbers

| Field | Value |
|---|---|
| **Values** | `merge \| leave-separate` |
| **Initial** | `merge` |
| **Applies to** | fo:index-page-citation-list, fo:index-key-reference |
| **Inherited** | Yes |
| **Percentages** | N/A |

Specifies whether or not sequential page numbers within an `fo:index-key-reference` or `fo:index-page-citation-list` (if `merge-ranges-across-index-key-references` is "merge") are merged into a range.

Values have the following meanings:

- **merge** -- Merge three or more consecutive page numbers into a range.
- **leave-separate** -- Do not merge page numbers into ranges.

### merge-pages-across-index-key-references

| Field | Value |
|---|---|
| **Values** | `merge \| leave-separate` |
| **Initial** | `merge` |
| **Applies to** | fo:index-page-citation-list |
| **Inherited** | Yes |
| **Percentages** | N/A |

Specifies whether or not multiple references to the same page by different `fo:index-key-reference` formatting objects will be retained as individual cited page items or if only a single cited page item will be retained.

Values have the following meanings:

- **merge** -- Only the first occurrence, in document order of the `fo:index-key-reference` formatting objects, of a reference to a given page number generated by multiple `fo:index-key-reference` formatting objects is retained.
- **leave-separate** -- Multiple references to the same page generated by different `fo:index-key-reference` formatting objects are retained.

### page-number-treatment

| Field | Value |
|---|---|
| **Values** | `link \| no-link` |
| **Initial** | `no-link` |
| **Applies to** | fo:index-page-citation-list, fo:index-key-reference |
| **Inherited** | Yes |
| **Percentages** | N/A |

Specifies whether or not page numbers in the index should be hyperlinks.

Values have the following meanings:

- **link** -- Page numbers in the index should be navigable links back to the source of the reference as for `fo:basic-link`.
- **no-link** -- Page numbers should not be links.

### page-citation-strategy

| Field | Value |
|---|---|
| **Values** | `all \| normal \| non-blank \| inherit` |
| **Initial** | `all` |
| **Applies to** | fo:page-number-citation, fo:page-number-citation-last |
| **Inherited** | No |
| **Percentages** | N/A |

This property determines what set of page areas are considered by a page number citation formatting object.

An area *matches* a ref-id trait with value V if the area is generated either (a) by the formatting object whose id trait is matched by V, or (b) by any descendant of that formatting object.

Values have the following meanings:

- **all** -- The set of pages that might be cited includes the pages containing, as a descendant, any area that matches the ref-id trait of the formatting object on which this property appears plus any blank pages generated by the referenced formatting object.
- **normal** -- The set of pages that might be cited includes the pages containing, as a descendant, any normal area that matches the ref-id trait of the formatting object on which this property appears, and which is either returned to that formatting object or is a descendant of a normal area returned to that formatting object.
- **non-blank** -- The set of pages that might be cited includes the pages containing, as a descendant, any area that matches the ref-id trait of the formatting object on which this property appears. This set of pages includes pages containing as descendants out-of-line areas such as those generated by `fo:footnote` and `fo:float`.

### page-citation-list-separator

This property is expressed through the `fo:index-page-citation-list-separator` formatting object rather than as a property value. The `fo:index-page-citation-list-separator` specifies the inline content (typically a comma followed by a space) placed between individual page citations in an index entry. It is a child of `fo:index-page-citation-list`.

### page-citation-range-separator

This property is expressed through the `fo:index-page-citation-range-separator` formatting object rather than as a property value. The `fo:index-page-citation-range-separator` specifies the inline content (typically an en-dash) placed between the start and end page numbers of a page range. It is a child of `fo:index-page-citation-list`.

## Code Samples

### Simple index entry with page citation list

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_multi-property-set -->
```xml
<fo:block>Eiffel Tower
  <fo:index-page-citation-list>
    <fo:index-key-reference ref-index-key="Eiffel Tower;;"/>
  </fo:index-page-citation-list>
</fo:block>
```

### Page number folio prefix for a glossary section

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_multi-property-set -->
```xml
<fo:page-sequence id="glossary" initial-page-number="1">
  <fo:page-number-folio-prefix>
    <fo:inline>G-</fo:inline>
  </fo:page-number-folio-prefix>
  <fo:flow>...</fo:flow>
</fo:page-sequence>
```

### DocBook indexterm source example

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_multi-property-set -->
```xml
<indexterm><primary>Eiffel Tower</primary></indexterm>
```

### DocBook indexterm with significance

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_multi-property-set -->
```xml
<indexterm significance="preferred">
<primary>Eiffel Tower</primary></indexterm>
```

### DocBook indexterm with range

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_multi-property-set -->
```xml
<indexterm id="ei.idx" class="startofrange">
<primary>Eiffel Tower</primary></indexterm>
...
<indexterm startref="ei.idx" class="endofrange"/>
```

### DocBook indexterm inside a figure

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_multi-property-set -->
```xml
<figure id="tower1">
<head>The Eiffel Tower</head>
<indexterm><primary>Eiffel Tower</primary></indexterm>
...
</figure>
```

### XSLT templates for transforming DocBook indexterms to XSL-FO index markup

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_multi-property-set -->
```xml
<xsl:template match="indexterm[@significance='preferred']"
     priority="100">
  <fo:wrapper>
    <xsl:attribute name="index-key">
      <xsl:value-of select="primary"/>
      <xsl:text>;</xsl:text>
      <xsl:value-of select="secondary"/>
      <xsl:text>;</xsl:text>
      <xsl:value-of select="tertiary"/>
      <xsl:text>;preferred</xsl:text>
    </xsl:attribute>
  </fo:wrapper>
</xsl:template>

<xsl:template match="indexterm[@class='startofrange']"
     priority="75">
  <fo:index-range-begin id="{@id}"/>
    <xsl:attribute name="index-key">
      <xsl:value-of select="primary"/>
      <xsl:text>;</xsl:text>
      <xsl:value-of select="secondary"/>
      <xsl:text>;</xsl:text>
      <xsl:value-of select="tertiary"/>
    </xsl:attribute>
</xsl:template>

<xsl:template match="indexterm[@class='endofrange']"
     priority="75">
  <fo:index-range-end ref-id="{@startref}">
  </fo:index-range-end>
</xsl:template>

<xsl:template match="figure/indexterm" priority="50">
  <fo:wrapper>
    <xsl:attribute name="index-key">
      <xsl:value-of select="primary"/>
      <xsl:text>;</xsl:text>
      <xsl:value-of select="secondary"/>
      <xsl:text>;</xsl:text>
      <xsl:value-of select="tertiary"/>
      <xsl:text>;figure</xsl:text>
    </xsl:attribute>
  </fo:wrapper>
</xsl:template>

<xsl:template match="indexterm">
  <fo:wrapper>
    <xsl:attribute name="index-key">
      <xsl:value-of select="primary"/>
      <xsl:text>;</xsl:text>
      <xsl:value-of select="secondary"/>
      <xsl:text>;</xsl:text>
      <xsl:value-of select="tertiary"/>
    </xsl:attribute>
  </fo:wrapper>
</xsl:template>
```

### Resulting XSL-FO index markers in document order

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_multi-property-set -->
```xml
[E  9] <fo:wrapper index-key="Eiffel Tower;;"/>
[F 10] <fo:wrapper index-key="Eiffel Tower;;"/>
[G 11] <fo:wrapper index-key="Eiffel Tower;;"/>
[H 13] <fo:index-range-begin id="ei.idx" index-key="Eiffel Tower;;"/>
[Y 15] <fo:wrapper index-key="Eiffel Tower;;"/>
[C 15] <fo:wrapper index-key="Eiffel Tower;;;figure"/>
[K 16] <fo:index-range-end ref-id="ei.idx"/>
[L 18] <fo:index-range-begin id="ei2.idx" index-key="Eiffel Tower;;"/>
[A 19] <fo:wrapper index-key="Eiffel Tower;;;preferred"/>
[O 21] <fo:index-range-end ref-id="ei2.idx"/>
[B 23] <fo:wrapper index-key="Eiffel Tower;;;preferred"/>
[D 25] <fo:wrapper index-key="Eiffel Tower;;;figure"/>
[P 27] <fo:wrapper index-key="Eiffel Tower;;"/>
[Q 29] <fo:wrapper index-key="Eiffel Tower;;"/>
[R 30] <fo:wrapper index-key="Eiffel Tower;;"/>
[S 31] <fo:wrapper index-key="Eiffel Tower;;"/>
[T 32] <fo:wrapper index-key="Eiffel Tower;;"/>
[U 33] <fo:wrapper index-key="Eiffel Tower;;"/>
[V 34] <fo:wrapper index-key="Eiffel Tower;;"/>
[X 37] <fo:wrapper index-key="Eiffel Tower;;"/>
```

### Index page citation list with styled key references

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_multi-property-set -->
```xml
<fo:index-page-citation-list
   merge-sequential-page-numbers="merge"/>
  <fo:index-key-reference ref-index-key="Eiffel Tower;;;preferred"
         font-weight="bold"
         id="XB"/>
  <fo:index-key-reference ref-index-key="Eiffel Tower;;;figure"
         font-style="italic"
         id="XI">
    <fo:index-page-number-prefix>
      <fo:inline>[</fo:inline>
    </fo:index-page-number-prefix>
    <fo:index-page-number-suffix>
      <fo:inline>]</fo:inline>
    </fo:index-page-number-suffix>
  </fo:index-key-reference>
  <fo:index-key-reference ref-index-key="Eiffel Tower;;"
                 id="XX"/>
</fo:index-page-citation-list>
```

### Step 1: Cited page items sorted by index-key-reference

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_multi-property-set -->
```
[A] (19, fo:wrapper,           chapter,  XB)
[B] (23, fo:wrapper,           chapter,  XB)
[C] (15, fo:wrapper,           chapter,  XI)
[D] (25, fo:wrapper,           chapter,  XI)
[E] ( 9, fo:wrapper,           preface,  XX)
[F] (10, fo:wrapper,           preface,  XX)
[G] (11, fo:wrapper,           chapter,  XX)
[H] (13, fo:index-range-begin, chapter,  XX)
[I] (14, null,                 chapter,  XX)
[J] (15, null,                 chapter,  XX)
[K] (16, fo:index-range-end,   chapter,  XX)
[L] (18, fo:index-range-begin, chapter,  XX)
[M] (19, null,                 chapter,  XX)
[N] (20, null,                 chapter,  XX)
[O] (21, fo:index-range-end,   chapter,  XX)
[P] (27, fo:wrapper,           chapter,  XX)
[Q] (29, fo:wrapper,           chapter,  XX)
[R] (30, fo:wrapper,           chapter,  XX)
[S] (31, fo:wrapper,           chapter,  XX)
[T] (32, fo:wrapper,           chapter,  XX)
[U] (33, fo:wrapper,           chapter,  XX)
[V] (34, fo:wrapper,           chapter,  XX)
[X] (37, fo:wrapper,           glossary, XX)
```

### Step 2: Cited page items sorted by page number

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_multi-property-set -->
```
[E] ( 9, fo:wrapper,           preface,  XX)
[F] (10, fo:wrapper,           preface,  XX)
[G] (11, fo:wrapper,           chapter,  XX)
[H] (13, fo:index-range-begin, chapter,  XX)
[I] (14, null,                 chapter,  XX)
[J] (15, null,                 chapter,  XX)
[C] (15, fo:wrapper,           chapter,  XI)
[K] (16, fo:index-range-end,   chapter,  XX)
[L] (18, fo:index-range-begin, chapter,  XX)
[A] (19, fo:wrapper,           chapter,  XB)
[M] (19, null,                 chapter,  XX)
[N] (20, null,                 chapter,  XX)
[O] (21, fo:index-range-end,   chapter,  XX)
[B] (23, fo:wrapper,           chapter,  XB)
[D] (25, fo:wrapper,           chapter,  XI)
[P] (27, fo:wrapper,           chapter,  XX)
[Q] (29, fo:wrapper,           chapter,  XX)
[R] (30, fo:wrapper,           chapter,  XX)
[S] (31, fo:wrapper,           chapter,  XX)
[T] (32, fo:wrapper,           chapter,  XX)
[U] (33, fo:wrapper,           chapter,  XX)
[V] (34, fo:wrapper,           chapter,  XX)
[X] (37, fo:wrapper,           glossary, XX)
```

### Step 3: After merging ranges within each index-key-reference

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_multi-property-set -->
```
[E] ( 9,   fo:wrapper,            preface,  XX)
[F] (10,   fo:wrapper,            preface,  XX)
[G] (11,   fo:wrapper,            chapter,  XX)
([H] (13,  fo:index-range-begin,  chapter,  XX),
  [K] (16, fo:index-range-end,    chapter,  XX))
[C] (15,   fo:wrapper,            chapter,  XI)
([L] (18,  fo:index-range-begin,  chapter,  XX),
  [O] (21, fo:index-range-end,    chapter,  XX))
[A] (19,   fo:wrapper,            chapter,  XB)
[B] (23,   fo:wrapper,            chapter,  XB)
[D] (25,   fo:wrapper,            chapter,  XI)
[P] (27,   fo:wrapper,            chapter,  XX)
([Q] (29,  fo:wrapper,            chapter,  XX),
  [V] (34, fo:wrapper,            chapter,  XX))
[X] (37,   fo:wrapper,            glossary, XX)
```

### Step 4: After merge-pages-across-index-key-references="merge"

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_multi-property-set -->
```
[E] ( 9,   fo:wrapper,            preface,  XX)
[F] (10,   fo:wrapper,            preface,  XX)
[G] (11,   fo:wrapper,            chapter,  XX)
([H] (13,  fo:index-range-begin,  chapter,  XX),
  [K] (16, fo:index-range-end,    chapter,  XX))
([L] (18,  fo:index-range-begin,  chapter,  XX),
  [O] (21, fo:index-range-end,    chapter,  XX))
[B] (23,   fo:wrapper,            chapter,  XB)
[D] (25,   fo:wrapper,            chapter,  XI)
[P] (27,   fo:wrapper,            chapter,  XX)
([Q] (29,  fo:wrapper,            chapter,  XX),
  [V] (34, fo:wrapper,            chapter,  XX))
[X] (37,   fo:wrapper,            glossary, XX)
```

### Step 5a: Before merge-ranges-across-index-key-references (leave-separate)

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_multi-property-set -->
```
[E] ( 9, fo:wrapper,           preface,  XX)
[F] (10, fo:wrapper,           preface,  XX)
[G] (11, fo:wrapper,           chapter,  XX)
[H] (13, fo:index-range-begin, chapter,  XX)
[I] (14, null,                 chapter,  XX)
[C] (15, fo:wrapper,           chapter,  XI)
[K] (16, fo:index-range-end,   chapter,  XX)
[L] (18, fo:index-range-begin, chapter,  XX)
[A] (19, fo:wrapper,           chapter,  XB)
[N] (20, null,                 chapter,  XX)
[O] (21, fo:index-range-end,   chapter,  XX)
[B] (23, fo:wrapper,           chapter,  XB)
[D] (25, fo:wrapper,           chapter,  XI)
[P] (27, fo:wrapper,           chapter,  XX)
[Q] (29, fo:wrapper,           chapter,  XX)
[R] (30, fo:wrapper,           chapter,  XX)
[S] (31, fo:wrapper,           chapter,  XX)
[T] (32, fo:wrapper,           chapter,  XX)
[U] (33, fo:wrapper,           chapter,  XX)
[V] (34, fo:wrapper,           chapter,  XX)
[X] (37, fo:wrapper,           glossary, XX)
```

### Step 5b: After merge-ranges-across-index-key-references (leave-separate)

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_multi-property-set -->
```
[E] ( 9,   fo:wrapper,           preface,  XX)
[F] (10,   fo:wrapper,           preface,  XX)
[G] (11,   fo:wrapper,           chapter,  XX)
[H] (13,   fo:index-range-begin, chapter,  XX)
[I] (14,   null,                 chapter,  XX)
[C] (15,   fo:wrapper,           chapter,  XI)
[K] (16,   fo:index-range-end,   chapter,  XX)
[L] (18,   fo:index-range-begin, chapter,  XX)
[A] (19,   fo:wrapper,           chapter,  XB)
[N] (20,   null,                 chapter,  XX)
[O] (21,   fo:index-range-end,   chapter,  XX)
[B] (23,   fo:wrapper,           chapter,  XB)
[D] (25,   fo:wrapper,           chapter,  XI)
[P] (27,   fo:wrapper,           chapter,  XX)
([Q] (29,  fo:wrapper,           chapter,  XX),
  [V] (34, fo:wrapper,           chapter,  XX))
[X] (37,   fo:wrapper,           glossary, XX)
```

### Step 6: After merge-ranges-across-index-key-references="merge"

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_multi-property-set -->
```
[E] ( 9,   fo:wrapper,           preface,  XX)
[F] (10,   fo:wrapper,           preface,  XX)
[G] (11,   fo:wrapper,           chapter,  XX)
([H] (13,  fo:index-range-begin, chapter,  XX),
  [K] (16, fo:index-range-end,   chapter,  XX))
([L] (18,  fo:index-range-begin, chapter,  XX),
  [O] (21, fo:index-range-end,   chapter,  XX))
[B] (23,   fo:wrapper,           chapter,  XB)
[D] (25,   fo:wrapper,           chapter,  XI)
[P] (27,   fo:wrapper,           chapter,  XX)
([Q] (29,  fo:wrapper,           chapter,  XX),
  [V] (34, fo:wrapper,           chapter,  XX))
[X] (37,   fo:wrapper,           glossary, XX)
```

## See Also

- [fo-index-page-citation-list](fo-index-page-citation-list.md) -- The `fo:index-page-citation-list` formatting object
- [fo-index-key-reference](fo-index-key-reference.md) -- The `fo:index-key-reference` formatting object
- [fo-index-range-begin](fo-index-range-begin.md) -- The `fo:index-range-begin` formatting object
- [fo-index-range-end](fo-index-range-end.md) -- The `fo:index-range-end` formatting object
- [fo-index-page-number-prefix](fo-index-page-number-prefix.md) -- The `fo:index-page-number-prefix` formatting object
- [fo-index-page-number-suffix](fo-index-page-number-suffix.md) -- The `fo:index-page-number-suffix` formatting object
