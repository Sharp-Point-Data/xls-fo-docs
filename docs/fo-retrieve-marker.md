# fo:retrieve-marker

## Summary

The `fo:retrieve-marker` is used in conjunction with `fo:marker` to produce running headers or footers. Typical examples include dictionary headers showing the first and last word defined on the page, and headers showing the page's chapter and section titles.

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_retrieve-marker -->

## Areas

The `fo:retrieve-marker` does not directly generate any area. It is (conceptually) replaced by the children of the `fo:marker` that it retrieves.

## Trait Derivation

The properties and traits specified on the ancestors of the `fo:retrieve-marker` are taken into account when formatting the children of the retrieved `fo:marker` as if the children had the same ancestors as the `fo:retrieve-marker`.

## Constraints

- An `fo:retrieve-marker` is only permitted as the descendant of an `fo:static-content`.
- The `fo:retrieve-marker` specifies that the children of a selected `fo:marker` shall be formatted as though they replaced the `fo:retrieve-marker` in the formatting tree.
- The properties of the `fo:retrieve-marker` impose a hierarchy of preference on the areas of the area tree. Each `fo:marker` is conceptually attached to each normal area returned by the `fo:marker`'s parent formatting object. Additionally, an `fo:marker` is conceptually attached to each non-normal area that is directly generated by the `fo:marker`'s parent formatting object.
- The `fo:marker` whose children are retrieved is the one that is (conceptually) attached to the area that is at the top of this hierarchy.
- The term "containing page" is used to mean the page that contains the first area generated or returned by the children of the retrieved `fo:marker`.
- A qualifying area is one that has an attached `fo:marker` whose `marker-class-name` property value is the same as the `retrieve-class-name` property value of the `fo:retrieve-marker`.
- Qualifying area selection rules based on `retrieve-position`:
  - "first-starting-within-page": the first qualifying area in the containing page whose "is-first" trait has a value of "true" is preferred. If none, the first qualifying area in the containing page is preferred.
  - "first-including-carryover": the first qualifying area in the containing page is preferred.
  - "last-starting-within-page": the last qualifying area in the containing page whose "is-first" trait has a value of "true" is preferred. If none, the last qualifying area in the containing page is preferred.
  - "last-ending-within-page": the last qualifying area in the containing page whose "is-last" trait has a value of "true" is preferred. If none, the last qualifying area in the containing page is preferred.
- The `retrieve-boundary` property limits which pages are considered:
  - "page-sequence": areas from preceding page-sequences are excluded.
  - "page": only areas on the containing page are considered.
- If the hierarchy of areas is empty, no formatting objects are retrieved.

## Content Model

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_retrieve-marker -->
```xml
EMPTY
```

## Properties

| Property | Inherited | Conformance Level |
|---|---|---|
| `retrieve-class-name` | no | Extended |
| `retrieve-position` | no | Extended |
| `retrieve-boundary` | no | Extended |

## Usage Notes

- The `retrieve-class-name` property must match the `marker-class-name` of the `fo:marker` whose content should be retrieved.
- The `retrieve-position` property controls which marker instance is selected when multiple markers with the same class name exist on a page. Common values are "first-starting-within-page" and "last-starting-within-page".
- The `retrieve-boundary` property controls the scope of the search for markers. Use "page" to limit retrieval to the current page, "page-sequence" to include markers from preceding pages in the same page-sequence, or "document" for the entire document.
- The `fo:retrieve-marker` must appear within `fo:static-content` (used for page headers and footers). It cannot appear within `fo:flow`.
- Properties set on ancestors of the `fo:marker` in the flow are NOT inherited by the marker's content when it is retrieved. The marker content inherits from the ancestors of the `fo:retrieve-marker` instead.

## Code Samples

No code samples in spec for this formatting object.

## See Also

- `fo:marker` -- defines the content that can be retrieved
- `fo:retrieve-table-marker` -- retrieves marker content within table headers/footers
- `fo:static-content` -- the context in which retrieve-marker must appear
