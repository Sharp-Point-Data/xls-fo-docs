# fo:index-key-reference

## Summary

The `fo:index-key-reference` formatting object is used to generate a set of cited page items for all the occurrences of the specified index-key.

A "cited page item" is a collection containing: a reference to a page area, a reference to an `fo:index-key-reference`, and an index class.

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_index-key-reference -->

## Areas

The `fo:index-key-reference` does not generate any areas. The containing `fo:index-page-citation-list` formatting object uses the cited page items that it contains to produce the generated list of page numbers.

## Constraints

- Each `fo:index-key-reference` formatting object identifies one or more formatting objects in the formatting object tree with an `index-key` value that matches the `ref-index-key` property of the `fo:index-key-reference`. It is an error if there are no such formatting objects. Implementations should recover from this error by ignoring the `fo:index-key-reference`.
- If the matched `index-key` occurs on an `fo:index-range-begin`, all of the pages whose descendants include areas generated by formatting objects under the index range influence of that `fo:index-range-begin` are referenced by the generated cited page items.
- For each formatting object containing a matching `index-key`, a cited page item is generated for each page whose descendants include areas returned from that formatting object. The index class of these cited page items is taken from that formatting object.
- If there are no areas returned from that formatting object then a cited page item is generated referring to the page containing the first area returned from a following formatting object, if any, or the last area returned from a preceding formatting object, if any.
- Within each `fo:index-key-reference`, page ranges are expanded to a sequence of individual cited page items and all but one cited page item that refer to the same page are removed.

## Content Model

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_index-key-reference -->
```xml
(index-page-number-prefix?,index-page-number-suffix?)
```

## Properties

| Property | Inherited | Conformance Level |
|---|---|---|
| `page-number-treatment` | no | Extended |
| `ref-index-key` | no | Extended |

## Usage Notes

- The `ref-index-key` property specifies the index key whose page references should be generated. This must match the `index-key` value on one or more formatting objects in the document.
- The `page-number-treatment` property controls whether the generated page numbers are links back to the source. The value "link" makes each page number a link.
- Optional `fo:index-page-number-prefix` and `fo:index-page-number-suffix` children can add static text around each page number (e.g., "[" and "]" for figure references).
- In addition to the declared properties, formatting properties specified directly on the `fo:index-key-reference` (such as `font-weight`, `font-style`, etc.) are applied to the page numbers generated by this reference. This allows different styling for different categories of index entries.
- Multiple `fo:index-key-reference` elements within the same `fo:index-page-citation-list` can reference different index keys, allowing their page citations to be merged into a single formatted list.

## Code Samples

No code samples in spec for this formatting object. See the "Formatting Objects for Indexing" introduction section for comprehensive examples including multi-key references with prefix/suffix formatting.

## See Also

- `fo:index-page-citation-list` -- parent formatting object that groups and formats page citations
- `fo:index-page-number-prefix` -- optional child for static prefix text
- `fo:index-page-number-suffix` -- optional child for static suffix text
- `fo:index-range-begin` -- marks the start of an index range
