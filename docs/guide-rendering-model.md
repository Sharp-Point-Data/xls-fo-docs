# Rendering Model

## Overview

The rendering model defines the relationship between the area tree and visually rendered output. It specifies how areas generate marks on an output medium, how geometric positions of those marks are determined, and how conflicts between overlapping marks are resolved. The rendering model bridges the gap between the abstract area tree (produced by formatting) and the concrete visual presentation seen by the reader.

Source: [W3C XSL-FO 2.0 -- Rendering Model](https://www.w3.org/TR/xslfo20/#rendmodel)

## Marks Generated by Areas

<!-- Source: https://www.w3.org/TR/xslfo20/#rendmodel -->

Areas generate three types of marks:

1. **Background** -- the area `background`, if any.
2. **Intrinsic marks** -- marks intrinsic to the area (a glyph, image, or decoration), if any.
3. **Border** -- the area `border`, if any.

An area tree is rendered by causing marks to appear on an output medium in accordance with the areas in the area tree. The rendering model describes the geometric location of such marks and how conflicts between marks are to be resolved.

## Rendering Model Subsections

The rendering model is organized into six subsections, each covering a specific aspect of how areas are rendered. These subsections are covered in detail in [guide-area-model.md](guide-area-model.md):

### Geometry (id: rend-geo)

Each area is rendered in a particular location. Formatting object semantics describe the location of intrinsic marks relative to the object's content-rectangle edges (`left`, `right`, top, `bottom`). The geometry subsection defines how each area's location is determined. For page-viewport-areas, the correspondence is isometric to the output medium. Areas with area-class `xsl-fixed` are positioned relative to their ancestor page-viewport-area. Children of viewport-areas are positioned per the viewport geometry rules. All other areas are positioned relative to their nearest ancestor reference-area, using the `left-position`, `right-position`, `top-position`, and `bottom-position` traits, with additional shifting via `top-offset` and `left-offset` traits when `relative-position` is `relative`.

See [guide-area-model.md](guide-area-model.md) for full details.

### Viewport Geometry (id: rend-view)

A reference-area that is the child of a viewport-area is positioned with its start-edge and end-edge parallel to those of its parent viewport-area. The start-edge is offset by an inline-scroll-amount, and the before-edge is offset by a block-scroll-amount. When the `block-progression-dimension` of the reference-area exceeds that of the viewport-area and the `overflow` trait is `scroll`, the scroll amounts are determined by a scrolling mechanism provided by the user agent; otherwise, both are zero.

See [guide-area-model.md](guide-area-model.md) for full details.

### Visibility (id: rend-vis)

The visibility of marks depends on the location of the marks, the `visibility` of the area, and the `overflow` of any ancestor viewport-areas. An area with `visibility` set to `hidden` generates no marks. An area with `overflow` of `hidden` (or `scroll` in a non-dynamic environment) defines a clipping rectangle determined by the `clip` trait, and portions of descendant marks lying outside that rectangle do not appear.

See [guide-area-model.md](guide-area-model.md) for full details.

### Border, Padding, and Background (id: rend-border)

The border-rectangle and padding-rectangle are determined relative to the content-rectangle by the common `padding` and `border` `width` traits (e.g., `border-before-width`). For areas that are not children of a viewport-area, the `border` is rendered between the border-rectangle and the padding-rectangle. For children of viewport-areas, the `border` is not rendered. The `background` rendering depends on whether the area is part of a viewport/reference pair and the `background-attachment` trait value.

See [guide-area-model.md](guide-area-model.md) for full details.

### Intrinsic Marks (id: rend-intrinsic)

For each class of formatting objects, the marks intrinsic to its generated areas are specified in the formatting object description. For example, an `fo:character` object generates a glyph-area rendered by drawing a glyph within the content-rectangle in accordance with the area's font traits, `glyph-orientation`, and `blink` traits. Score traits (`underline-score`, `overline-score`, `through-score`) specify additional intrinsic marks whose thickness and position come from the nominal-font; where the font does not specify these, the values are implementation-dependent.

See [guide-area-model.md](guide-area-model.md) for full details.

### Layering and Conflict of Marks (id: rend-layer)

Marks are layered according to a partial ordering that defines which marks are "beneath" which other marks. When two marks conflict (apply to the same point on the output medium), the mark that is beneath does not affect those points. Within the same area, the `background` is beneath intrinsic marks, and intrinsic marks are beneath the `border`. Across areas, stacking layers are determined by stacking context and `z-index` values. When areas share the same stacking layer, ancestor backgrounds come beneath descendant marks, and descendant marks come beneath ancestor intrinsic marks and borders. If non-ancestor areas with the same stacking layer have conflicting non-background marks, it is an error; an implementation may recover by layering marks in pre-order traversal order.

See [guide-area-model.md](guide-area-model.md) for full details.

## Code Samples

No code samples in spec for this section.

## See Also

- [guide-area-model.md](guide-area-model.md) -- Full area model including rendering model subsection details
- [guide-formatting-intro.md](guide-formatting-intro.md) -- Introduction to formatting and the area tree
- [guide-introduction.md](guide-introduction.md) -- Overview of XSL processing including the rendering step
- `fo-page-sequence` -- Generates pages from flow content
- `properties-border.md` -- Border properties referenced in rendering
- `properties-background.md` -- Background properties referenced in rendering
