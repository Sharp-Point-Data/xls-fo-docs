# fo:retrieve-table-marker

## Summary

The `fo:retrieve-table-marker` is used in conjunction with `fo:marker` to produce table-headers and table-footers whose content can change over different pages, different regions or different columns. Typical examples include dictionary headers showing the first and last word defined in the part of the table on the current page, subtotals that give a subtotal of numbers in rows up to the last row on the current page, and table-continued captions that show if a table is continued after the current page.

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_retrieve-table-marker -->

## Areas

The `fo:retrieve-table-marker` does not directly generate any area. It is (conceptually) replaced by the children of the `fo:marker` that it retrieves.

## Trait Derivation

The properties and traits specified on the ancestors of the `fo:retrieve-table-marker` are taken into account when formatting the children of the retrieved `fo:marker` as if the children had the same ancestors as the `fo:retrieve-table-marker`.

## Constraints

- An `fo:retrieve-table-marker` is only permitted as the descendant of an `fo:table-header` or `fo:table-footer` or as a child of `fo:table` in a position where `fo:table-header` or `fo:table-footer` is permitted.
- The `fo:retrieve-table-marker` specifies that the children of a selected `fo:marker` shall be formatted as though they replaced the `fo:retrieve-table-marker` in the formatting tree.
- The `fo:table` that is a parent of both the `fo:table-body` (that has the `fo:marker`s as its descendants) and the `fo:table-header` or `fo:table-footer` that has the `fo:retrieve-table-marker` as its descendant generates one or more normal block-areas. These are said to be the "retrieve scope area set". The retrieve scope area set is limited by the constraints specified by `retrieve-boundary-within-table` property.
- A qualifying area is one that has an attached `fo:marker` whose `marker-class-name` property value is the same as the `retrieve-class-name` property value of the `fo:retrieve-table-marker`, and is a descendant of a retrieve scope area.
- Qualifying area selection rules based on `retrieve-position-within-table`:
  - "first-starting": the first qualifying area in the primary retrieve scope area whose "is-first" trait is "true" is preferred. Fallback: first qualifying area in the primary retrieve scope area. Then: last qualifying area in any retrieve scope area.
  - "first-including-carryover": the first qualifying area in the primary retrieve scope area is preferred. Fallback: last qualifying area in any retrieve scope area.
  - "last-starting": the last qualifying area in any retrieve scope area whose "is-first" trait is "true" is preferred. Fallback: last qualifying area in any retrieve scope area.
  - "last-ending": the last qualifying area in any retrieve scope area whose "is-last" trait is "true" is preferred. Fallback: last qualifying area in any retrieve scope area.
- If the hierarchy of areas is empty, no formatting objects are retrieved.

## Content Model

<!-- Source: https://www.w3.org/TR/xslfo20/#fo_retrieve-table-marker -->
```xml
EMPTY
```

## Properties

| Property | Inherited | Conformance Level |
|---|---|---|
| `retrieve-class-name` | no | Extended |
| `retrieve-position-within-table` | no | Extended |
| `retrieve-boundary-within-table` | no | Extended |

## Usage Notes

- The `retrieve-class-name` property must match the `marker-class-name` of the `fo:marker` whose content should be retrieved.
- The `retrieve-position-within-table` property controls which marker instance is selected. Common values are "first-starting", "first-including-carryover", "last-starting", and "last-ending".
- The `retrieve-boundary-within-table` property controls the scope of the search. Values include "table" (all areas generated by the table), "table-fragment" (the current table fragment/column), and "page" (all table areas on the current page).
- The `fo:retrieve-table-marker` must appear within a table header or footer context.
- A common pattern is to use markers in `fo:table-body` rows to track running subtotals, and `fo:retrieve-table-marker` in the `fo:table-footer` to display the subtotal for the current page fragment.
- Another common pattern is a "Table continued..." caption that appears only when the table spans multiple pages. This is achieved by placing a non-empty "continued" marker on all rows except the last, and an empty marker on the last row.

## Code Samples

The following three-part example from the spec demonstrates `fo:retrieve-table-marker` used for subtotals and "Table continued..." captions: the source XML, the XSLT stylesheet, and the resulting XSL-FO output.

**Source XML with numbered data:**

<!-- Source: xslspec.xml line 17323 -->
```xml
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<numbers>
  <number>1</number>
  <number>2</number>
  <!-- and so on... -->
  <number>11</number>
  <number>12</number>
</numbers>
```

**XSLT stylesheet using `fo:marker` in table body rows and `fo:retrieve-table-marker` in the table footer to display running subtotals, a "Table continued..." caption, and a grand total on the last page:**

<!-- Source: xslspec.xml line 17334 -->
```xml
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
xmlns:fo="http://www.w3.org/1999/XSL/Format" version="1.0">
  <xsl:strip-space elements="*"/>

  <xsl:template match="numbers">
    <fo:table>
      <fo:table-column/>
      <fo:table-footer>
        <fo:table-row>
          <fo:table-cell font-weight="bold">
            <fo:block>
 <fo:retrieve-table-marker retrieve-class-name="subtotal-caption"
retrieve-position-within-table="last-ending"/>
 <fo:retrieve-table-marker retrieve-class-name="subtotal"
retrieve-position-within-table="last-ending"/>
            </fo:block>
          </fo:table-cell>
        </fo:table-row>
        <fo:retrieve-table-marker retrieve-class-name="continued"
          retrieve-position-within-table="last-ending"/>
      </fo:table-footer>
      <fo:table-body>
        <fo:marker marker-class-name="continued">
          <fo:table-row>
            <fo:table-cell>
              <fo:block>Table continued...</fo:block>
            </fo:table-cell>
          </fo:table-row>
        </fo:marker>
        <fo:marker marker-class-name="subtotal-caption">
                Subtotal:
        </fo:marker>
        <xsl:apply-templates/>
      </fo:table-body>
    </fo:table>
  </xsl:template>

  <xsl:template match="number">
    <fo:table-row>
      <fo:marker marker-class-name="subtotal">
        <xsl:value-of select="sum(preceding::number)+text()"/>
      </fo:marker>
      <xsl:if test="position() = last()">
        <fo:marker marker-class-name="continued"/>
        <fo:marker marker-class-name="subtotal-caption">
          Total:
        </fo:marker>
      </xsl:if>
      <fo:table-cell>
        <fo:block>
          <xsl:apply-templates/>
        </fo:block>
      </fo:table-cell>
    </fo:table-row>
  </xsl:template>

</xsl:stylesheet>
```

**Resulting XSL-FO output with `fo:table`, `fo:marker` instances on each row, and `fo:retrieve-table-marker` in the footer retrieving subtotals and continuation captions:**

<!-- Source: xslspec.xml line 17396 -->
```xml
<?xml version="1.0" encoding="UTF-8"?>
<fo:table>
  <fo:table-column/>
  <fo:table-footer>
    <fo:table-row>
      <fo:table-cell font-weight="bold">
        <fo:block>
          <fo:retrieve-table-marker
            retrieve-position-within-table="last-ending"
            retrieve-class-name="subtotal-caption"/>
          <fo:retrieve-table-marker
            retrieve-position-within-table="last-ending"
            retrieve-class-name="subtotal"/>
        </fo:block>
      </fo:table-cell>
    </fo:table-row>
    <fo:retrieve-table-marker retrieve-class-name="continued"
      retrieve-position-within-table="last-ending"/>
  </fo:table-footer>
  <fo:table-body>
    <fo:marker marker-class-name="continued">
      <fo:table-row>
        <fo:table-cell>
          <fo:block>Table continued...</fo:block>
        </fo:table-cell>
      </fo:table-row>
    </fo:marker>
    <fo:marker marker-class-name="subtotal-caption">
      Subtotal:
    </fo:marker>
    <fo:table-row>
      <fo:marker marker-class-name="subtotal">1</fo:marker>
      <fo:table-cell>
        <fo:block>1</fo:block>
      </fo:table-cell>
    </fo:table-row>
    <fo:table-row>
      <fo:marker marker-class-name="subtotal">3</fo:marker>
      <fo:table-cell>
        <fo:block>2</fo:block>
      </fo:table-cell>
    </fo:table-row>
    <!-- and so on... -->
    <fo:table-row>
      <fo:marker marker-class-name="subtotal">66</fo:marker>
      <fo:table-cell>
        <fo:block>11</fo:block>
      </fo:table-cell>
    </fo:table-row>
    <fo:table-row>
      <fo:marker marker-class-name="subtotal">78</fo:marker>
      <fo:marker marker-class-name="continued"/>
      <fo:marker marker-class-name="subtotal-caption">
        Total:
      </fo:marker>
      <fo:table-cell>
        <fo:block>12</fo:block>
      </fo:table-cell>
    </fo:table-row>
  </fo:table-body>
</fo:table>
```

## See Also

- [fo:marker](fo-marker.md) — defines the content that can be retrieved
- [fo:retrieve-marker](fo-retrieve-marker.md) — retrieves marker content within static-content (page headers/footers)
- [fo:table-header](fo-table-header.md) — typical location for retrieve-table-marker
- [fo:table-footer](fo-table-footer.md) — typical location for retrieve-table-marker
